codetasty.revision.2.0
{"ts":1518219029,"restoring":false,"user_id":7359,"patch":[{"diffs":[[1,"<?php\n$version = 1.8;\n?>\n<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset=\"utf-8\">\n    <title>CHS DB v<?=$version?></title>\n\n    <!-- Sets initial viewport load and disables zooming  -->\n    <meta name=\"viewport\" content=\"initial-scale=1, maximum-scale=1\">\n\n    <!-- Makes your prototype chrome-less once bookmarked to your phone's home screen -->\n    <meta name=\"apple-mobile-web-app-capable\" content=\"yes\">\n    <meta name=\"apple-mobile-web-app-status-bar-style\" content=\"black\">\n\n    <!-- Include the compiled Ratchet CSS -->\n    <link href=\"css/ratchet.css?v=<?=$version?>\" rel=\"stylesheet\">\n    <link rel=\"stylesheet\" href=\"css/icons.css?v=<?=$version?>\" />\n    <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js\"></script>\n    <script src=\"https://www.gstatic.com/firebasejs/3.7.2/firebase.js\"></script>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/store.js/1.3.20/store.min.js\"></script>\n\n    <!-- Include the compiled Ratchet JS -->\n    <script src=\"js/ratchet.js?v=<?=$version?>\"></script>\n    <style>\n      .alert {\n        margin: 5px;\n        padding: 4px;\n        border-radius: 5px;\n        border: 1px solid;\n      }\n      .alert-success {\n        border-color: #19a419;\n        background-color: rgba(119, 217, 118, 0.34);\n      }\n      .alert-danger {\n        border-color: #cd2828;\n        background-color: rgba(217, 118, 118, 0.34);\n      }\n      cloudflare-app {\n        display:none;\n      }\n      header.bar {\n        margin-top: 4px;\n        padding-bottom:5px;\n      }\n      .content {\n        margin-top: 10px;\n      }\n      .icon.fa {\n        margin-top: -3px;\n      }\n      .table-view-cell .icon.fa {\n        margin-top: 1px;\n      }\n    </style>\n  </head>\n  <body>\n    <?php\n    session_start();\n    include(\"../../assets/inc/include.php\");\n    $manage = new Manager();\n    $mysqli = $manage->database();\n    \n    if(isset($_SESSION['username'])) {\n    \t$cuser = $manage->get_user();\n    }\n    \n    function mustLogIn() {\n    \tif(!isset($_SESSION['username'])) {\n    \t\theader(\"location: /db/app/login.php\");\n    \t\tdie(\"<script>window.location.href='/db/app/login.php';</script>You must be logged in to see this.\");\n    \t}\n    }\n    function him($userid, $hey=-159) {\n    \t$manage = new Manager();\n    \t$mysqli = $manage->database();\n    \t\n    \t$us = $mysqli->query(\"SELECT * FROM `users` WHERE `id`=\".$userid.\"\");\n    \tif($us->num_rows <= 0) {\n    \t\treturn \"Unknown\";\n    \t}\n    \t$us = $us->fetch_array();\n    \tswitch($hey) {\n    \t\tcase \"fullname\":\n    \t\t\treturn $us['fname'].\" \".$us['lname'];\n    \t\t\tbreak;\n    \t\tcase -159:\n    \t\t\treturn $us;\n    \t\t\tbreak;\n    \t\tdefault:\n    \t\t\treturn $us[$hey];\n    \t\t\tbreak;\n    \t}\n    }\n    \n    $vars1 = $mysqli->query(\"SELECT * FROM `variables`\");\n    $vars = array();\n    while($var = $vars1->fetch_array()) {\n    \t$vars[$var['name']] = $var['value'];\n    }\n    \n    function myTruncate($string, $limit=10, $pad=\"...\") {\n      // return with no change if string is shorter than $limit\n      if(strlen($string) <= $limit) return $string;\n      $string = substr($string, 0, $limit) . $pad;\n      return $string;\n    }\n    ?>\n    <style>\n      .tab-badge {\n         position:relative;\n      }\n      .tab-badge[data-badge]:after {\n         content:attr(data-badge);\n         position:absolute;\n         top:-3px;\n         right:-15px;\n         font-size:.6em;\n         background:#929292;\n         color:white;\n         width:18px;height:18px;\n         text-align:center;\n         line-height:23px;\n         border-radius:50%;\n         border: 1.5px solid white;\n         font-family: \"Helvetica Neue\", Helvetica, sans-serif;\n      }\n      .active .tab-badge[data-badge]:after {\n        background: #428bca;\n      }\n      .msg {\n    \t\tcolor: black;\n    \t\tpadding: 3px;\n    \t\tclear: both;\n    \t\tmargin-bottom: 3px;\n    \t\toverflow-x: hide;\n    \t\tdisplay: inline-block;\n    \t\tmax-width: 98%;\n    \t\twhite-space: wrap;\n    \t\tword-wrap: break-word;\n    \t\tword-spacing: -1px;\n    \t\tcursor: default;\n    \t\t-webkit-touch-callout: none;\n    \t\t-webkit-user-select: none;\n    \t\t-khtml-user-select: none;\n    \t\t-moz-user-select: none;\n    \t\t-ms-user-select: none;\n    \t\tuser-select: none;\n    \t}\n    \t\n    \t.msg p {\n    \t  color: black;\n    \t}\n    \t\n    \t.msg.them {\n    \t\tbackground-color: #d1e8ff;\n    \t\tborder-radius: 7px 7px 7px 0px;\n    \t\tfloat: left;\n    \t}\n    \t\n    \t.msg.me {\n    \t\tbackground-color: #56adff;\n    \t\tborder-radius: 7px 7px 0px 7px;\n    \t\ttext-align: right;\n    \t\tfloat: right;\n    \t}\n    \t\n    \t.msg-name {\n    \t\tfont-weight:bold;\n    \t\tfont-size: 80%;\n    \t\tline-height: 0px;\n    \t}\n    </style>\n    <nav class=\"bar bar-tab bar-footer\">\n      <?php\n      $tsk = $mysqli->query(\"SELECT * FROM `todo` WHERE `done`=0 AND `assigned_to`=\".$cuser['id'])->num_rows;\n      $rep = $mysqli->query(\"SELECT * FROM `reports` WHERE `done`=0\")->num_rows;\n      ?>\n      <a class=\"tab-item <?=(basename($_SERVER[\"SCRIPT_FILENAME\"], '.php')==\"index\")?\"active\":\"\"?>\" href=\"index.php\">\n        <span class=\"icon fa fa-check<?=($tsk>0)?\" tab-badge\":\"\"?>\"<?=($tsk>0)?\" data-badge=\\\"$tsk\\\"\":\"\"?>></span>\n        <span class=\"tab-label\">Tasks</span>\n      </a>\n      <a class=\"tab-item <?=(basename($_SERVER[\"SCRIPT_FILENAME\"], '.php')==\"reports\")?\"active\":\"\"?>\" href=\"reports.php\">\n        <span class=\"icon fa fa-info-circle<?=($rep>0)?\" tab-badge\":\"\"?>\"<?=($rep>0)?\" data-badge=\\\"$rep\\\"\":\"\"?>></span>\n        <span class=\"tab-label\">Reports</span>\n      </a>\n      <a class=\"tab-item <?=(basename($_SERVER[\"SCRIPT_FILENAME\"], '.php')==\"notes\")?\"active\":\"\"?>\" href=\"notes.php\">\n        <span class=\"icon fa fa-sticky-note\"></span>\n        <span class=\"tab-label\">Notes</span>\n      </a>\n      <a class=\"tab-item <?=(basename($_SERVER[\"SCRIPT_FILENAME\"], '.php')==\"facs\")?\"active\":\"\"?>\" href=\"facs.php\">\n        <span class=\"icon fa fa-address-book\"></span>\n        <span class=\"tab-label\">Faculty</span>\n      </a>\n      <a class=\"tab-item <?=(basename($_SERVER[\"SCRIPT_FILENAME\"], '.php')==\"menu\")?\"active\":\"\"?>\" href=\"menu.php\">\n        <span class=\"icon fa fa-bars\"></span>\n        <span class=\"tab-label\">Menu</span>\n      </a>\n    </nav>\n    <script>\n    window.addEventListener('push', function() {\n      function newtask() {\n  \t\t\t$(\"#hasdeadline\").on(\"change\", function() {\n  \t\t\t\tif($(\"#hasdeadline\").prop('checked')) {\n  \t\t\t\t\t$(\"#deadline\").show();\n  \t\t\t\t}else{\n  \t\t\t\t\t$(\"#deadline\").hide();\n  \t\t\t\t}\n  \t\t\t});\n  \t\t}\n    \tfunction vars() {\n    \t\t$(\".btn-save\").click(function() {\n    \t\t\tvar obid = $(this);\n    \t\t\t$.post(\"/db/savevar.php\", { name: obid.data(\"var\"), value: $(\"#\"+obid.data(\"var\")).val() })\n    \t\t  .done(function( stuff ) {\n    \t\t  \tif(stuff == \"true\"){\n    \t\t\t\t\t$(\"#\"+obid.data(\"var\")+\"_tt\").text(\"Saved!\");\n    \t\t\t\t\t$(\"#\"+obid.data(\"var\")+\"_te\").text(\"\");\n    \t\t\t\t\tvar it = obid;\n    \t\t\t\t\tsetTimeout(function() {\n    \t\t\t\t\t\t$(\"#\"+it.data(\"var\")+\"_tt\").text(\"\");\n    \t\t\t\t\t}, 500);\n    \t\t  \t}else{\n    \t\t  \t\t$(\"#\"+obid.data(\"var\")+\"_te\").text(\"Error! \"+stuff);\n    \t\t  \t}\n    \t\t  });\n    \t\t\treturn false;\n    \t\t});\n    \t\t$(\".btn-copy\").click(function() {\n    \t\t\tprompt(\"Copy this to use in code:\",\"\\<\\?\\=\\$vars\\[\\'\"+$(this).data(\"var\")+\"\\'\\]\\?\\>\");\n    \t\t\treturn false;\n    \t\t});\n    \t}\n\t\n      function strUrl(url) {\n            return url.split(/[?#]/)[0].replace(/(^\\w+:|^)\\/\\//, '').replace(/\\./g, '-');\n          }\n    \tfunction inito() {\n    \t  console.log(\"Chat init.\")\n    \t\t//// Initialize Firebase.\n    \t\tvar config = {\n  \t\t\t\tapiKey: \"AIzaSyC7DypYRweLX9UC8LvUYQNLsufLZ95dZYM\",\n  \t\t\t\tauthDomain: \"perfect-transit-186317.firebaseapp.com\",\n  \t\t\t\tdatabaseURL: \"https://perfect-transit-186317.firebaseio.com\",\n  \t\t\t};\n  \t\t\tif (!firebase.apps.length) {\n    \t\t  firebase.initializeApp(config);\n    \t\t  //// Get Firebase Database reference.\n    \t\t  var messagesRef = firebase.database().ref().child(\"chsdbchat\")\n  \t\t\t}else{\n  \t\t\t  messagesRef = firebase.database().ref().child(\"chsdbchat\")\n  \t\t\t}\n    \t\t;\n    \t\t$(\"#add\").click(function() {\n    \t\t\tif (($(\"#text\").val() != \"\") && ($(\"#name\").val() != \"\")) {\n    \t\t\t\tvar name = \"<?=$cuser['username']?>\";\n    \t\t\t\tvar text = $(\"#text\").val();\n    \t\t\t\tmessagesRef.push({\n    \t\t\t\t\tname: name,\n    \t\t\t\t\ttext: text\n    \t\t\t\t});\n    \t\t\t\t$(\"#text\").val(\"\");\n    \t\t\t}\n    \t\t});\n    \t\t// Add a callback that is triggered for each comment\n    \t\tmessagesRef.limitToLast(10).on(\"child_added\", function(snapshot) {\n    \t\t\tvar message = snapshot.val();\n    \t\t  //time = message.time;\n          //var d = new Date(time);\n          //var when = d.toDateString();\n          if(message.name == \"<?=$cuser['username']?>\") {\n            $(\".list\").append(\"<div class='msg me'><p>\"+message.text+\"</p></div>\");\n          }else{\n            $(\".list\").append(\"<div class='msg them'><span class='msg-name'>\"+message.name+\"</span><p>\"+message.text+\"</p></div>\");\n          }\n    \t\t\t\n    \t\t\t$(\".content\")[0].scrollTop = $(\".content\")[0].scrollHeight;\n    \t\t});\n    \t}\n    \n    \t// Helper to get hash from end of URL or generate a random one.\n    \tfunction getExampleRef() {\n    \t\tvar ref = firebase.database().ref();\n    \t\tvar hash = window.location.hash.replace(/#/g, '');\n    \t\tif (hash) {\n    \t\t\tref = ref.child(hash);\n    \t\t} else {\n    \t\t\tref = ref.push(); // generate unique location.\n    \t\t\twindow.location = window.location + '#' + ref.key; // add it as a hash to the URL.\n    \t\t}\n    \t\tif (typeof console !== 'undefined') {\n    \t\t\tconsole.log('Firebase data: ', ref.toString());\n    \t\t}\n    \t\treturn ref;\n    \t}\n    \tfunction loginPage() {\n    \t  console.log(store.get(\"uname\"));\n    \t  $(\"#username\").val(store.get(\"uname\"));\n    \t  if(store.get(\"pwd\")) {\n    \t    $(\"#password\").val(store.get(\"pwd\"));\n    \t    $(\"#loginn\").submit();\n    \t    \n    \t  }\n  \t\t\t$(\"#username\").on(\"keyup\", function() {\n  \t\t\t\tstore.set(\"uname\", $(\"#username\").val());\n  \t\t\t});\n  \t\t\t$(\"#password\").on(\"keyup\", function() {\n  \t\t\t\tstore.set(\"pwd\", $(\"#password\").val());\n  \t\t\t});\n    \t}\n    \tconsole.log(window.location.href);\n    \tif(window.location.href.indexOf(\"chat.php\") != -1) {\n    \t\tinito();\n    \t}\n    \tif(window.location.href.indexOf(\"vars.php\") != -1) {\n    \t\tvars();\n    \t}\n    \tif(window.location.href.indexOf(\"newtask.php\") != -1) {\n    \t\tnewtask();\n    \t}\n    \tif(window.location.href.indexOf(\"edittask.php\") != -1) {\n    \t\tnewtask();\n    \t}\n    \tif(window.location.href.indexOf(\"login.php\") != -1) {\n    \t\tloginPage();\n    \t}\n    \tif(window.location.href.indexOf(\"logout.php\") != -1) {\n    \t\tloginPage();\n    \t}\n    });\n    </script>"]],"start1":0,"start2":0,"length1":0,"length2":10475}],"length":10475}