codetasty.revision.2.0
{"ts":1523893881,"restoring":false,"user_id":7359,"patch":[{"diffs":[[1,"<?php\r\n\r\n\t/*\r\n\r\n\t\tSingle File PHP Gallery 4.7.0 (chspic)\r\n\r\n\t\tSee EULA in readme.txt for commercial use\r\n\t\tSee readme.txt for configuration\r\n\r\n\t\tReleased: 29-Dec-2016\r\n\t\thttp://sye.dk/chspic/\r\n\t\tby Kenny Svalgaard\r\n\r\n\t*/\r\n\r\n\terror_reporting(0);\r\n\t\r\n\t//\t----------- CONFIGURATION START ------------\r\n\r\n\tdefine('GALLERY_ROOT', './');\r\n\tdefine('DATA_ROOT', './_chspic_data/');\r\n\tdefine('SECURITY_PHRASE', 'chs827409492hh92');\r\n\tdefine('PASSWORD', '');\r\n\tdefine('ADMIN', FALSE);\r\n\r\n\tdefine('DIR_NAME_FILE', '_name.txt');\r\n\tdefine('DIR_THUMB_FILE', '_image.jpg');\r\n\tdefine('DIR_DESC_FILE', '_desc.txt');\r\n\tdefine('DIR_BANNER_FILE', '_banner.txt');\r\n\tdefine('DIR_DESC_IN_GALLERY', TRUE);\r\n\tdefine('DIR_DESC_IN_INFO', TRUE);\r\n\tdefine('DIR_SORT_REVERSE', FALSE);\r\n\tdefine('DIR_SORT_BY_TIME', FALSE);\r\n\t$dir_exclude = array('_chspic_data', '_chspic_icons');\r\n\tdefine('DIR_EXCLUDE_REGEX', '');\r\n\r\n\tdefine('SHOW_IMAGE_EXT', FALSE);\r\n\tdefine('IMAGE_SORT_REVERSE', FALSE);\r\n\tdefine('IMAGE_SORT_BY_TIME', FALSE);\r\n\tdefine('IMAGE_EXIF_TIME', FALSE);\r\n\tdefine('ROTATE_IMAGES', TRUE);\r\n\tdefine('IMAGE_JPEG_QUALITY', 90);\r\n\tdefine('IMAGE_EXCLUDE_REGEX', '');\r\n\r\n\tdefine('SHOW_FILES', TRUE);\r\n\tdefine('SHOW_FILE_EXT', TRUE);\r\n\tdefine('FILE_IN_NEW_WINDOW', TRUE);\r\n\tdefine('FILE_THUMB_EXT', '.jpg');\r\n\tdefine('FILE_THUMB_DEFAULT', '');\r\n\tdefine('FILE_SORT_REVERSE', FALSE);\r\n\tdefine('FILE_SORT_BY_TIME', FALSE);\r\n\t$file_exclude = array();\r\n\t$file_ext_exclude = array('.php', '.txt', '.sell');\r\n\tdefine('FILE_EXCLUDE_REGEX', '');\r\n\r\n\tdefine('ICONS_DIR', '_chspic_icons/');\r\n\tdefine('LINK_BACK', 'http://chs.ironk12.org/');\r\n\tdefine('CHARSET', 'utf-8');\r\n\tdefine('DATE_FORMAT', 'Day Date Month Year Hour:Min:Sec');\r\n\tdefine('DESC_EXT', '.txt');\r\n\tdefine('DESC_NL_TO_BR', FALSE);\r\n\tdefine('SORT_DIVIDER', '--');\r\n\tdefine('SORT_ALL_NATURAL', TRUE);\r\n\tdefine('FONT_SIZE', 17);\r\n\tdefine('UNDERSCORE_AS_SPACE', TRUE);\r\n\tdefine('SHOW_EXIF_INFO', TRUE);\r\n\tdefine('SHOW_IPTC_INFO', TRUE);\r\n\tdefine('SHOW_INFO_BY_DEFAULT', FALSE);\r\n\tdefine('ROUND_CORNERS', 0);\r\n\r\n\tdefine('THUMB_MAX_WIDTH', 210);\r\n\tdefine('THUMB_MAX_HEIGHT', 150);\r\n\tdefine('THUMB_SQUARE', FALSE);\r\n\tdefine('THUMB_ENLARGE', FALSE);\r\n\tdefine('THUMB_JPEG_QUALITY', 75);\r\n\r\n\tdefine('USE_PREVIEW', FALSE);\r\n\tdefine('PREVIEW_MAX_WIDTH', 600);\r\n\tdefine('PREVIEW_MAX_HEIGHT', 400);\r\n\tdefine('PREVIEW_ENLARGE', FALSE);\r\n\tdefine('PREVIEW_JPEG_QUALITY', 75);\r\n\t\r\n\tdefine('LOW_IMAGE_RESAMPLE_QUALITY', FALSE);\r\n\tdefine('KEYBOARD_NAVIGATION', TRUE);\r\n\tdefine('WATERMARK', '');\r\n\tdefine('WATERMARK_FRACTION', 0.1);\r\n\r\n\tdefine('MPO_STEREO_IMAGE', TRUE);\r\n\tdefine('MPO_STEREO_DOTS', TRUE);\r\n\tdefine('MPO_STEREO_MAX_WIDTH', 300);\r\n\tdefine('MPO_STEREO_MAX_HEIGHT', 300);\r\n\tdefine('MPO_FULL_IMAGE', TRUE);\r\n\tdefine('MPO_FULL_ANAGLYPH', TRUE);\r\n\tdefine('MPO_FULL_MAX_WIDTH', 1200);\r\n\tdefine('MPO_FULL_MAX_HEIGHT', 800);\r\n\tdefine('MPO_SPACING', 20);\r\n\r\n\tdefine('INFO_BOX_WIDTH', 250);\r\n\tdefine('MENU_BOX_HEIGHT', 70);\r\n\tdefine('NAV_BAR_HEIGHT', 25);\r\n\tdefine('THUMB_BORDER_WIDTH', 1);\r\n\tdefine('THUMB_MARGIN', 10);\r\n\tdefine('THUMB_BOX_MARGIN', 7);\r\n\tdefine('THUMB_BOX_EXTRA_HEIGHT', 14);\r\n\tdefine('THUMB_CHARS_MAX', 20);\r\n\tdefine('FULLIMG_BORDER_WIDTH', 5);\r\n\r\n\tdefine('NAVI_CHARS_MAX', 100);\r\n\tdefine('OVERLAY_OPACITY', 90);\r\n\tdefine('FADE_DURATION_MS', 300);\r\n\tdefine('SLIDESHOW_DELAY_SEC', 3);\r\n\r\n\tdefine('SHOW_MAX_IMAGES', FALSE);\r\n\tdefine('SHOW_IMAGE_DAYS', FALSE);\r\n\tdefine('DELETE_IMAGE_DAYS', FALSE);\r\n\r\n\tdefine('PAYPAL_ENABLED', FALSE);\r\n\tdefine('PAYPAL_ACCOUNT', '');\r\n\tdefine('PAYPAL_CURRENCY', 'USD');\r\n\tdefine('PAYPAL_EXTENSION', '.sell');\r\n\r\n\tdefine('TEXT_PAYPAL_FOR_SALE', 'Sales information');\r\n\tdefine('TEXT_PAYPAL_PRICE', 'Price (USD)');\r\n\tdefine('TEXT_PAYPAL_NO_PRICE', 'No price yet');\r\n\tdefine('TEXT_PAYPAL_IN_STOCK', 'In stock');\r\n\tdefine('TEXT_PAYPAL_OUT_OF_STOCK', 'Out of stock');\r\n\tdefine('TEXT_PAYPAL_ITEM_ID', 'Item ID');\r\n\tdefine('TEXT_PAYPAL_BUY', 'Buy this item');\r\n\tdefine('TEXT_PAYPAL_OUT_BACK', 'Item is no longer in stock. Please click back and refresh the page to update inventory.');\r\n\tdefine('TEXT_PAYPAL_PLEASE_WAIT', 'Redirecting to PayPal. Please wait... (Can take a few seconds)');\r\n\r\n\tdefine('TEXT_GALLERY_NAME', 'Cedar High School');\r\n\tdefine('TEXT_BANNER', 'Cedar High School Photos');\r\n\tdefine('TEXT_HOME', 'Home');\r\n\tdefine('TEXT_CLOSE_IMG_VIEW', 'Close Image');\r\n\tdefine('TEXT_ACTUAL_SIZE', 'Actual Size');\r\n\tdefine('TEXT_FULLRES', 'Full resolution');\r\n\tdefine('TEXT_PREVIOUS', '<< Previous');\r\n\tdefine('TEXT_NEXT', 'Next >>');\r\n\tdefine('TEXT_INFO', 'Information');\r\n\tdefine('TEXT_DOWNLOAD', 'Download full-size image');\r\n\tdefine('TEXT_SLIDESHOW', 'Slideshow');\r\n\tdefine('TEXT_NO_IMAGES', '');\r\n\tdefine('TEXT_DATE', 'Date');\r\n\tdefine('TEXT_FILESIZE', 'File size');\r\n\tdefine('TEXT_IMAGESIZE', 'Full Image');\r\n\tdefine('TEXT_DISPLAYED_IMAGE', 'Displayed Image');\r\n\tdefine('TEXT_DIR_NAME', 'Gallery Name');\r\n\tdefine('TEXT_IMAGE_NAME', 'Image Name');\r\n\tdefine('TEXT_FILE_NAME', 'File Name');\r\n\tdefine('TEXT_DIRS', 'Directories');\r\n\tdefine('TEXT_IMAGES', 'Images');\r\n\tdefine('TEXT_IMAGE_NUMBER', 'Image number');\r\n\tdefine('TEXT_FILES', 'Files');\r\n\tdefine('TEXT_DESCRIPTION', 'Description');\r\n\tdefine('TEXT_DIRECT_LINK_GALLERY', 'Direct link to Gallery');\r\n\tdefine('TEXT_DIRECT_LINK_IMAGE', 'Direct link to Image');\r\n\tdefine('TEXT_NO_PREVIEW_FILE', 'No Preview for file');\r\n\tdefine('TEXT_IMAGE_LOADING', 'Image Loading ');\r\n\tdefine('TEXT_LINKS', 'Links');\r\n\tdefine('TEXT_NOT_SCALED', 'Not Scaled');\r\n\tdefine('TEXT_LINK_BACK', 'CHS Home');\r\n\tdefine('TEXT_THIS_IS_FULL', 'Full');\r\n\tdefine('TEXT_THIS_IS_PREVIEW', 'Preview');\r\n\tdefine('TEXT_SCALED_TO', 'Scaled to');\r\n\tdefine('TEXT_YES', 'Yes');\r\n\tdefine('TEXT_NO', 'No');\r\n\tdefine('TEXT_FIRST_VIEW', 'This is first view of this image. Refresh page to get information.');\r\n\r\n\tdefine('TEXT_LOGIN', 'Login');\r\n\tdefine('TEXT_LOGOUT', 'Logout');\r\n\tdefine('TEXT_ADMIN', 'Admin');\r\n\tdefine('TEXT_OK', 'OK');\r\n\tdefine('TEXT_CANCEL', 'Cancel');\r\n\tdefine('TEXT_DELETE', 'Delete');\r\n\tdefine('TEXT_RENAME', 'Rename');\r\n\tdefine('TEXT_MOVE', 'Move');\r\n\tdefine('TEXT_MOVE_TO', 'Move to');\r\n\tdefine('TEXT_MKDIR', 'Create Directory');\r\n\tdefine('TEXT_UPLOAD', 'Upload');\r\n\tdefine('TEXT_NOTHING', 'Nothing Selected');\r\n\tdefine('TEXT_ONLY_ONE', 'Select only one element to use this function');\r\n\tdefine('TEXT_ONE_IMAGE', 'Select only one image to use this function');\r\n\r\n\tdefine('TEXT_EXIF', 'EXIF');\r\n\tdefine('TEXT_EXIF_DATE', 'Date');\r\n\tdefine('TEXT_EXIF_CAMERA', 'Camera');\r\n\tdefine('TEXT_EXIF_ISO', 'ISO');\r\n\tdefine('TEXT_EXIF_SHUTTER', 'Shutter Speed');\r\n\tdefine('TEXT_EXIF_APERTURE', 'Aperture');\r\n\tdefine('TEXT_EXIF_FOCAL', 'Focal Length');\r\n\tdefine('TEXT_EXIF_FLASH', 'Flash fired');\r\n\tdefine('TEXT_EXIF_MISSING', 'No EXIF information in image');\r\n\r\n\tdefine('TEXT_IPTC', 'IPTC');\r\n\tdefine('TEXT_IPTC_TITLE', 'Document Title');\r\n\tdefine('TEXT_IPTC_URGENCY', 'Urgency');\r\n\tdefine('TEXT_IPTC_CATEGORY', 'Category');\r\n\tdefine('TEXT_IPTC_SUBCATEGORIES', 'Subcategories');\r\n\tdefine('TEXT_IPTC_SPECIALINSTRUCTIONS', 'Special Instructions');\r\n\tdefine('TEXT_IPTC_CREATIONDATE', 'Creation Date');\r\n\tdefine('TEXT_IPTC_AUTHORBYLINE', 'Author Byline');\r\n\tdefine('TEXT_IPTC_AUTHORTITLE', 'Author Title');\r\n\tdefine('TEXT_IPTC_CITY', 'City');\r\n\tdefine('TEXT_IPTC_STATE', 'State');\r\n\tdefine('TEXT_IPTC_COUNTRY', 'Country');\r\n\tdefine('TEXT_IPTC_OTR', 'OTR');\r\n\tdefine('TEXT_IPTC_HEADLINE', 'Headline');\r\n\tdefine('TEXT_IPTC_SOURCE', 'Source');\r\n\tdefine('TEXT_IPTC_PHOTOSOURCE', 'Photo Source');\r\n\tdefine('TEXT_IPTC_COPYRIGHT', 'Copyright');\r\n\tdefine('TEXT_IPTC_CAPTION', 'Caption');\r\n\tdefine('TEXT_IPTC_CAPTIONWRITER', 'Caption Writer');\r\n\tdefine('TEXT_IPTC_MISSING', 'No IPTC information in image');\r\n\r\n\t$color_body_back = '#FFFFFF';\r\n\t$color_body_text = '#990000';\r\n\t$color_body_link = '#ffffff';\r\n\t$color_body_hover = '#aaaaaa';\r\n\r\n\t$color_thumb_border = '#606060';\r\n\t$color_fullimg_border = '#ffffff';\r\n\r\n\t$color_marked_back = '#ff0000';\r\n\t$color_marked_text = '#000000';\r\n\t\r\n\t$color_dir_box_border = '#505050';\r\n\t$color_dir_box_back = '#f3cf89';\r\n\t$color_dir_box_text = '#000000';\r\n\t$color_dir_hover = '#ffffff';\r\n\t$color_dir_hover_text = '#000000';\r\n\r\n\t$color_img_box_border = '#505050';\r\n\t$color_img_box_back = '#f3cf89';\r\n\t$color_img_box_text = '#990000';\r\n\t$color_img_hover = '#ffffff';\r\n\t$color_img_hover_text = '#000000';\r\n\r\n\t$color_file_box_border = '#404040';\r\n\t$color_file_box_back = '#f3cf89';\r\n\t$color_file_box_text = '#aaaaaa';\r\n\t$color_file_hover = '#ffffff';\r\n\t$color_file_hover_text = '#000000';\r\n\r\n\t$color_desc_box_border = '#404040';\r\n\t$color_desc_box_back = '#f3cf89';\r\n\t$color_desc_box_text = '#990000';\r\n\r\n\t$color_menu_back = '#000000';\r\n\t$color_menu_top = '#303030';\r\n\r\n\t$color_navbar_back = '#202020';\r\n\t$color_navbar_top = '#303030';\r\n\r\n\t$color_button_nav_border = '#404040';\r\n\t$color_button_nav_back = '#101010';\r\n\t$color_button_nav_text ='#f3cf89';\r\n\r\n\t$color_info_back = '#000000';\r\n\t$color_info_border = '#606060';\r\n\t$color_info_text = '#990000';\r\n\r\n\t$color_infobox_border = '#404040';\r\n\t$color_infobox_back ='#101010';\r\n\r\n\t$color_button_border = '#808080';\r\n\t$color_button_back = '#000000';\r\n\t$color_button_text = '#f3cf89';\r\n\t$color_button_border_off = '#505050';\r\n\t$color_button_back_off = '#000000';\r\n\t$color_button_text_off = '#505050';\r\n\t$color_button_hover = '#ffffff';\r\n\t$color_button_hover_text = '#990000';\r\n\t$color_button_on = '#aaaaaa';\r\n\t$color_button_text_on = '#000000';\r\n\r\n\t$color_overlay = '#000000';\r\n\r\n\t//\t----------- CONFIGURATION END ------------\r\n\r\n\tfunction chspic_array_sort(&$arr, &$arr_time, $sort_by_time, $sort_reverse)\r\n\t{\r\n\t\tif ($sort_by_time)\r\n\t\t{\r\n\t\t\tif ($sort_reverse)\r\n\t\t\t{\r\n\t\t\t\tarray_multisort ($arr_time, SORT_DESC, SORT_NUMERIC, $arr);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tarray_multisort ($arr_time, SORT_ASC, SORT_NUMERIC, $arr);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tif (SORT_ALL_NATURAL)\r\n\t\t\t{\r\n\t\t\t\tnatcasesort ($arr);\r\n\t\t\t\t$arr = array_values($arr);\r\n\t\t\t\tif ($sort_reverse)\r\n\t\t\t\t{\r\n\t\t\t\t\t$arr = array_reverse ($arr);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tif ($sort_reverse)\r\n\t\t\t\t{\r\n\t\t\t\t\trsort ($arr);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tsort ($arr);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tfunction chspic_file_size($size)\r\n\t{\r\n\t\t$sizename = array('Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB');\r\n\t\treturn ($size ? round($size/pow(1024, ($i = floor(log($size, 1024)))), 2).' '.$sizename[$i] : '0 Bytes');\r\n\t}\r\n\r\n\r\n\tfunction chspic_base64url_encode($plain)\r\n\t{\r\n\t\t$base64 = base64_encode($plain);\r\n\t\t$base64url = strtr($base64, '+/', '-_');\r\n\t\treturn rtrim($base64url, '=');\r\n\t}\r\n\r\n\r\n\tfunction chspic_base64url_decode($base64url)\r\n\t{\r\n\t\t$base64 = strtr($base64url, '-_', '+/');\r\n\t\t$plain = base64_decode($base64);\r\n\t\treturn ($plain);\r\n\t}\r\n\r\n\r\n\tfunction chspic_url_string($dir = '', $img = '')\r\n\t{\r\n\t\t$res = $dir.'*'.$img.'*';\r\n\t\treturn chspic_base64url_encode($res.hash('sha256', $res.SECURITY_PHRASE));\r\n\t}\r\n\r\n\r\n\tfunction chspic_url_decode($string)\r\n\t{\r\n\t\t$get = explode('*', chspic_base64url_decode($string));\r\n\t\tif ((hash('sha256', $get[0].'*'.$get[1].'*'.SECURITY_PHRASE) === $get[2]) and (strpos(GALLERY_ROOT.$get[0].$get[1], '/../') === FALSE) and (strpos($get[0].$get[1], '\\\\') === FALSE))\r\n\t\t{\r\n\t\t\treturn array($get[0], $get[1]);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\treturn FALSE;\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tfunction sts($str, $block_html_tags=false, $nl_to_br=true)\r\n\t{\r\n\t\t$str = str_replace(\"\\r\", \"\", $str);\r\n\t\t$str = str_replace(\"\\n\", ($nl_to_br?\"<br>\":\"\"), $str);\r\n\t\t$str = str_replace(\"\\\\\", \"\\\\\\\\\", $str);\r\n\t\t$str = str_replace(\"\\\"\", \"\\\\\\\"\", $str);\r\n\t\t$str = str_replace(\"'\", \"\\'\", $str);\r\n\t\tif ($block_html_tags)\r\n\t\t{\r\n\t\t\t$str = str_replace(\"<\", \"&lt;\", $str);\r\n\t\t}\r\n\t\treturn $str;\r\n\t}\r\n\r\n\r\n\tfunction chspic_display_name($name, $show_ext)\r\n\t{\r\n\t\t$break_pos = strpos($name, SORT_DIVIDER);\r\n\t\tif ($break_pos !== FALSE)\r\n\t\t{\r\n\t\t\t$display_name = substr($name, $break_pos + strlen(SORT_DIVIDER));\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$display_name = $name;\r\n\t\t}\r\n\t\tif (UNDERSCORE_AS_SPACE)\r\n\t\t{\r\n\t\t\t$display_name = str_replace('_', ' ', $display_name);\r\n\t\t}\r\n\t\tif (!$show_ext)\r\n\t\t{\r\n\t\t\t$display_name = substr($display_name, 0, strrpos($display_name, '.'));\r\n\t\t}\r\n\t\treturn $display_name;\r\n\t}\r\n\r\n\r\n\tfunction chspic_ext($file)\r\n\t{\r\n\t\tif (strrpos($file, '.') === FALSE)\r\n\t\t{\r\n\t\t\treturn 'nodot';\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\treturn strtolower(substr($file, strrpos($file, '.')));\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tfunction chspic_image_type($file)\r\n\t{\r\n\t\t$type = chspic_ext($file);\r\n\t\tif (($type == '.jpg') or ($type == '.jpeg') or ((MPO_FULL_IMAGE or MPO_STEREO_IMAGE) and ($type == '.mpo')))\r\n\t\t{\r\n\t\t\treturn 'jpeg';\r\n\t\t}\r\n\t\telseif ($type == '.png')\r\n\t\t{\r\n\t\t\treturn 'png';\r\n\t\t}\r\n\t\telseif ($type == '.gif')\r\n\t\t{\r\n\t\t\treturn 'gif';\r\n\t\t}\r\n\t\treturn FALSE;\r\n\t}\r\n\r\n\r\n\tfunction chspic_mpo_image($file)\r\n\t{\r\n\t\tif (!$mpo = @file_get_contents($file))\r\n\t\t{\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t$offset = 0;\r\n\t\t$marker = true;\r\n\t\t$imgOffset = array();\r\n\t\t$markA = chr(0xFF).chr(0xD8).chr(0xFF).chr(0xE1);\r\n\t\t$markB = chr(0xFF).chr(0xD9).chr(0xFF).chr(0xE0);\r\n\t\twhile ($marker!==false)\r\n\t\t{\r\n\t\t\t$marker = strpos($mpo, $markA, $offset);\r\n\t\t\tif ($marker===false)\r\n\t\t\t{\r\n\t\t\t\t$marker = strpos($mpo, $markB, $offset);\r\n\t\t\t}\r\n\t\t\tif ($marker!==false)\r\n\t\t\t{\r\n\t\t\t\t$imgOffset[] = $marker;\r\n\t\t\t\t$offset = $marker+4;\r\n\t\t\t}\r\n\t\t}\r\n\t\t$imgOffset[] = strlen($mpo);\r\n\t\tif (count($imgOffset)<2)\r\n\t\t{\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif (count($imgOffset)>2)\r\n\t\t{\r\n\t\t\t$img_left = imagecreatefromstring(substr($mpo, $imgOffset[0], $imgOffset[1]-$imgOffset[0]));\r\n\t\t\t$img_right = imagecreatefromstring(substr($mpo, $imgOffset[1], $imgOffset[2]-$imgOffset[1]));\r\n\t\t\tlist($mpo_stereo_width, $mpo_stereo_height) = chspic_aspect_resize(imagesx($img_left), imagesy($img_left), MPO_STEREO_MAX_WIDTH, MPO_STEREO_MAX_HEIGHT, true);\r\n\t\t\tlist($mpo_full_width, $mpo_full_height) = chspic_aspect_resize(imagesx($img_left), imagesy($img_left), MPO_FULL_MAX_WIDTH, MPO_FULL_MAX_HEIGHT, false);\r\n\t\t\t$stereo_dot_space = 0;\r\n\t\t\tif (MPO_STEREO_DOTS)\r\n\t\t\t{\r\n\t\t\t\t$dot_size=3;\r\n\t\t\t\t$stereo_dot_space = 2*$dot_size+2*MPO_SPACING;\r\n\t\t\t}\r\n\t\t\t$stereo_align = 0;\r\n\t\t\t$new_img_width = 0;\r\n\t\t\t$new_img_height = 0;\r\n\t\t\t$full_offset_y = 0;\r\n\t\t\tif (MPO_STEREO_IMAGE)\r\n\t\t\t{\r\n\t\t\t\t$new_img_width += $mpo_stereo_width*2+MPO_SPACING;\r\n\t\t\t\t$new_img_height += $stereo_dot_space + $mpo_stereo_height + (MPO_FULL_IMAGE ? MPO_SPACING : 0);\r\n\t\t\t\t$full_offset_y = $mpo_stereo_height+MPO_SPACING+$stereo_dot_space;\r\n\t\t\t}\r\n\t\t\t$full_offset_x = round(($new_img_width-$mpo_full_width)/2);\r\n\t\t\tif (MPO_FULL_IMAGE)\r\n\t\t\t{\r\n\t\t\t\tif ($mpo_full_width > $new_img_width)\r\n\t\t\t\t{\r\n\t\t\t\t\t$new_img_width = $mpo_full_width;\r\n\t\t\t\t\t$stereo_align = (int)(($mpo_full_width-($mpo_stereo_width*2+MPO_SPACING))/2);\r\n\t\t\t\t\t$full_offset_x = 0;\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t\t$new_img_height += $mpo_full_height;\r\n\t\t\t}\r\n\t\t\t$new_image = imagecreatetruecolor($new_img_width, $new_img_height);\r\n\t\t\t$tmp_left = imagecreatetruecolor($mpo_full_width, $mpo_full_height);\r\n\t\t\timagecopyresampled($tmp_left, $img_left, 0, 0, 0, 0, $mpo_full_width, $mpo_full_height, imagesx($img_left), imagesy($img_left));\r\n\t\t\t$tmp_right = imagecreatetruecolor($mpo_full_width, $mpo_full_height);\r\n\t\t\timagecopyresampled($tmp_right, $img_right, 0, 0, 0, 0, $mpo_full_width, $mpo_full_height, imagesx($img_right), imagesy($img_right));\r\n\t\t\tif (MPO_FULL_IMAGE)\r\n\t\t\t{\r\n\t\t\t\tif (MPO_FULL_ANAGLYPH)\r\n\t\t\t\t{\r\n\t\t\t\t\t$anaglyph_image = imagecreatetruecolor($mpo_full_width, $mpo_full_height);\r\n\t\t\t\t\timagealphablending($anaglyph_image, false);\r\n\t\t\t\t\tfor($y=0; $y<$mpo_full_height; $y++)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tfor($x=0; $x<$mpo_full_width; $x++)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t$left_color = imagecolorat($tmp_left, $x, $y);\r\n\t\t\t\t\t\t\t$r = (int)(($left_color >> 16) & 255) * 0.299 + (($left_color >> 8) & 255) * 0.587 + (($left_color) & 255) * 0.114;\r\n\t\t\t\t\t\t\tif ($r > 255)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t$r = 255;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t$g = (imagecolorat($tmp_right, $x, $y) >> 8) & 255;\r\n\t\t\t\t\t\t\t$b = (imagecolorat($tmp_right, $x, $y)) & 255;\r\n\t\t\t\t\t\t\timagesetpixel($anaglyph_image, $x, $y, imagecolorallocate($anaglyph_image, $r, $g, $b));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\timagecopyresampled($new_image, $anaglyph_image, $full_offset_x, $full_offset_y, 0, 0, $mpo_full_width, $mpo_full_height, $mpo_full_width, $mpo_full_height);\r\n\t\t\t\t\timagedestroy($anaglyph_image);\r\n\t\t\t\t\timagedestroy($tmp_left);\r\n\t\t\t\t\timagedestroy($tmp_right);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\timagecopyresampled($new_image, $img_left, $full_offset_x, $full_offset_y, 0, 0, $mpo_full_width, $mpo_full_height, imagesx($img_left), imagesy($img_left));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (MPO_STEREO_IMAGE)\r\n\t\t\t{\r\n\t\t\t\timagecopyresampled($new_image, $img_left, $stereo_align, $stereo_dot_space, 0, 0, $mpo_stereo_width, $mpo_stereo_height, imagesx($img_left), imagesy($img_left));\r\n\t\t\t\timagedestroy($img_left);\r\n\t\t\t\timagecopyresampled($new_image, $img_right, $stereo_align+$mpo_stereo_width+MPO_SPACING, $stereo_dot_space, 0, 0, $mpo_stereo_width, $mpo_stereo_height, imagesx($img_right), imagesy($img_right));\r\n\t\t\t\timagedestroy($img_right);\r\n\t\t\t\t$white = imagecolorallocate($new_image, 255, 255, 255);\r\n\t\t\t\timagefilledrectangle($new_image, $stereo_align+(int)($mpo_stereo_width/2)-3, MPO_SPACING-3, $stereo_align+(int)($mpo_stereo_width/2)+3, MPO_SPACING+3, $white);\r\n\t\t\t\timagefilledrectangle($new_image, $stereo_align+MPO_SPACING+(int)($mpo_stereo_width*1.5)-3, MPO_SPACING-3, $stereo_align+MPO_SPACING+(int)($mpo_stereo_width*1.5)+3, MPO_SPACING+3, $white);\r\n\t\t\t}\r\n\t\t\treturn $new_image;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$image = imagecreatefromstring(substr($mpo, $imgOffset[0], $imgOffset[1]-$imgOffset[0]));\r\n\t\t\tlist($mpo_width, $mpo_height) = chspic_aspect_resize(imagesx($image), imagesy($image), MPO_FULL_MAX_WIDTH, MPO_FULL_MAX_HEIGHT, false);\r\n\t\t\t$new_image = imagecreatetruecolor($mpo_width, $mpo_height);\r\n\t\t\timagecopyresampled($new_image, $image, 0, 0, 0, 0, $mpo_width, $mpo_height, imagesx($image), imagesy($image));\r\n\t\t\timagedestroy($image);\r\n\t\t\treturn $new_image;\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tfunction chspic_aspect_resize($image_width, $image_height, $max_width, $max_height, $enlarge)\r\n\t{\r\n\t\tif (($image_width < $max_width) and ($image_height < $max_height) and !$enlarge)\r\n\t\t{\r\n\t\t\t$new_img_height = $image_height;\r\n\t\t\t$new_img_width = $image_width;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$aspect_x = $image_width / $max_width;\r\n\t\t\t$aspect_y = $image_height / $max_height;\r\n\t\t\tif ($aspect_x > $aspect_y)\r\n\t\t\t{\r\n\t\t\t\t$new_img_width = $max_width;\r\n\t\t\t\t$new_img_height = $image_height / $aspect_x;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t$new_img_height = $max_height;\r\n\t\t\t\t$new_img_width = $image_width / $aspect_y;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn array($new_img_width, $new_img_height);\r\n\t}\r\n\r\n\r\n\tfunction chspic_mkdir($dir)\r\n\t{\r\n\t\tif (!is_dir($dir))\r\n\t\t{\r\n\t\t\tmkdir($dir, 0777, TRUE);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\r\n\tfunction chspic_get_dir($dir, $for_dir_info=FALSE)\r\n\t{\r\n\t\tglobal $dir_exclude, $file_exclude, $file_ext_exclude;\r\n\t\t$dirs = array();\r\n\t\t$dirs_time = array();\r\n\t\t$images = array();\r\n\t\t$images_time = array();\r\n\t\t$files = array();\r\n\t\t$files_time = array();\r\n\t\t$misc = array();\r\n\t\t$directory_handle = opendir(GALLERY_ROOT.$dir);\r\n\t\tif ($directory_handle != FALSE)\r\n\t\t{\r\n\t\t\twhile(($var=readdir($directory_handle))!==false)\r\n\t\t\t{\r\n\t\t\t\tif (is_dir(GALLERY_ROOT.$dir.$var))\r\n\t\t\t\t{\r\n\t\t\t\t\tif (($var != '.') and ($var != '..') and !in_array(strtolower($var), $dir_exclude) and !@preg_match(DIR_EXCLUDE_REGEX, $var))\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$dirs[] = $var;\r\n\t\t\t\t\t\tif (DIR_SORT_BY_TIME)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t$dirs_time[] = filemtime(GALLERY_ROOT.$dir.$var.'/.');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telseif (chspic_image_type($var))\r\n\t\t\t\t{\r\n\t\t\t\t\tif (($var != DIR_THUMB_FILE) and !@preg_match(IMAGE_EXCLUDE_REGEX, $var))\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif ((DELETE_IMAGE_DAYS) and (filemtime(GALLERY_ROOT.$dir.$var)<(time()-(DELETE_IMAGE_DAYS*86400))))\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tunlink(GALLERY_ROOT.$dir.$var);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t$images[] = $var;\r\n\t\t\t\t\t\t\tif (IMAGE_SORT_BY_TIME)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tif (IMAGE_EXIF_TIME)\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tif ($img_info=@file_get_contents(DATA_ROOT.'info/'.$dir.$var))\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t$spl=explode('|', $img_info);\r\n\t\t\t\t\t\t\t\t\t\t$images_time[]=$spl[4];\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t$images_time[]=filemtime(GALLERY_ROOT.$dir.$var);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t$images_time[]=filemtime(GALLERY_ROOT.$dir.$var);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telseif (SHOW_FILES)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (!in_array(strtolower($var), $file_exclude) and !in_array(chspic_ext($var), $file_ext_exclude) and !@preg_match(FILE_EXCLUDE_REGEX, $var))\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$files[] = $var;\r\n\t\t\t\t\t\tif (FILE_SORT_BY_TIME)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t$files_time[] = filemtime(GALLERY_ROOT.$dir.$var);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif ((chspic_ext($var)==DESC_EXT)or(chspic_ext($var)==PAYPAL_EXTENSION))\r\n\t\t\t\t{\r\n\t\t\t\t\t$misc[] = $var;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif ($for_dir_info)\r\n\t\t\t{\r\n\t\t\t\t$misc = 0;\r\n\t\t\t}\r\n\t\t\tif (SHOW_FILES)\r\n\t\t\t{\r\n\t\t\t\tforeach ($files as $val)\r\n\t\t\t\t{\r\n\t\t\t\t\t$fti = array_search($val.FILE_THUMB_EXT, $images);\r\n\t\t\t\t\tif ($fti !== FALSE)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif ($for_dir_info)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t$misc++;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tarray_splice($images, $fti, 1);\r\n\t\t\t\t\t\t\tarray_splice($images_time, $fti, 1);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tclosedir($directory_handle);\r\n\t\t\tchspic_array_sort($dirs, $dirs_time, DIR_SORT_BY_TIME, DIR_SORT_REVERSE);\r\n\t\t\tchspic_array_sort($images, $images_time, IMAGE_SORT_BY_TIME, IMAGE_SORT_REVERSE);\r\n\t\t\tchspic_array_sort($files, $files_time, FILE_SORT_BY_TIME, FILE_SORT_REVERSE);\r\n\t\t\treturn array($dirs, $images, $files, $misc);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\theader('Location: '.$_SERVER['PHP_SELF']);\r\n\t\t\texit;\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tfunction chspic_browse_dirs()\r\n\t{\r\n\t\techo '<!DOCTYPE html><html><head><meta charset=\"'.CHARSET.'\"></head><body onload=\"parent.sendData(document.getElementById(\\'dataContainer\\').innerHTML)\"><div id=\"dataContainer\"><br>'.\r\n\t\t'&nbsp;'.TEXT_MOVE_TO.': <b>'.TEXT_HOME.'/'.GALLERY.'</b><br><br>'.\r\n\t\t'<span class=\"chspic_button\" onclick=\"admMovePost(\\''.chspic_url_string(GALLERY,'').'\\',\\''.TEXT_HOME.'/'.GALLERY.'\\')\">OK</span>'.\r\n\t\t'<span class=\"chspic_button\" onclick=\"admMovePost(false,false)\">'.TEXT_CANCEL.'</span><br><br>'.\r\n\t\t'<span class=\"chspic_button\" onclick=\"admMove(\\''.chspic_url_string().'\\')\">'.TEXT_HOME.'</span>';\r\n\t\t$dirs=explode('/',GALLERY);\r\n\t\t$path='';\r\n\t\t$postDiv='';\r\n\t\tforeach($dirs as $dir)\r\n\t\t{\r\n\t\t\tif ($dir)\r\n\t\t\t{\r\n\t\t\t\t$path.=$dir.'/';\r\n\t\t\t\techo '<div class=\"in\"><span class=\"chspic_button\" onclick=\"admMove(\\''.chspic_url_string($path,'').'\\')\">'.$dir.'</span>';\r\n\t\t\t\t$postDiv.='</div>';\r\n\t\t\t}\r\n\t\t}\r\n\t\t$items=@scandir(GALLERY_ROOT.GALLERY);\r\n\t\tif ($items!==false)\r\n\t\t{\r\n\t\t\techo '<div class=\"in\">';\r\n\t\t\tforeach($items as $var)\r\n\t\t\t{\r\n\t\t\t\tif ((is_dir(GALLERY_ROOT.GALLERY.$var)) and ($var != '.') and ($var != '..'))\r\n\t\t\t\t{\r\n\t\t\t\t\techo '<span class=\"chspic_button\" onclick=\"admMove(\\''.chspic_url_string(GALLERY.$var.'/','').'\\')\">'.$var.'</span><br>';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\techo $postDiv.'</div></div></div></body></html>';\r\n\t}\r\n\r\n\r\n\tfunction chspic_image($image_dir, $image_file, $func, $download=FALSE)\r\n\t{\r\n\t\t$image_path_file = DATA_ROOT.$func.'/'.$image_dir.$image_file;\r\n\t\t$image_type = chspic_image_type($image_file);\r\n\t\tif ($func == 'image')\r\n\t\t{\r\n\t\t\tif (!file_exists($image_path_file))\r\n\t\t\t{\r\n\t\t\t\t$image_path_file = GALLERY_ROOT.$image_dir.$image_file;\r\n\t\t\t}\r\n\t\t\tif ($download)\r\n\t\t\t{\t\t\r\n\t\t\t\theader('Content-Type: application/octet-stream');\r\n\t\t\t\theader('Content-Disposition: attachment; filename=\"'.$image_file.'\"');\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\theader('Content-Type: image/'.$image_type);\r\n\t\t\t\theader('Content-Disposition: filename=\"'.$image_file.'\"');\r\n\t\t\t}\r\n\t\t\treadfile($image_path_file);\r\n\t\t\texit;\r\n\t\t}\r\n\t\tif (($func == 'thumb') or ($func == 'preview'))\r\n\t\t{\r\n\t\t\tif (file_exists($image_path_file))\r\n\t\t\t{\r\n\t\t\t\theader('Content-Type: image/'.$image_type);\r\n\t\t\t\theader('Content-Disposition: filename=\"'.$func.'_'.$image_file.'\"');\r\n\t\t\t\treadfile($image_path_file);\r\n\t\t\t\texit;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tif($func == 'thumb')\r\n\t\t\t\t{\r\n\t\t\t\t\t$max_width = THUMB_MAX_WIDTH;\r\n\t\t\t\t\t$max_height = THUMB_MAX_HEIGHT;\r\n\t\t\t\t\t$enlarge = THUMB_ENLARGE;\r\n\t\t\t\t\t$jpeg_quality = THUMB_JPEG_QUALITY;\r\n\t\t\t\t\t$source_img = GALLERY_ROOT.$image_dir.$image_file;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t$max_width = PREVIEW_MAX_WIDTH;\r\n\t\t\t\t\t$max_height = PREVIEW_MAX_HEIGHT;\r\n\t\t\t\t\t$enlarge = PREVIEW_ENLARGE;\r\n\t\t\t\t\t$jpeg_quality = PREVIEW_JPEG_QUALITY;\r\n\t\t\t\t\t$source_img = DATA_ROOT.'image/'.$image_dir.$image_file;\r\n\t\t\t\t\tif (!file_exists($source_img))\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$source_img = GALLERY_ROOT.$image_dir.$image_file;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t$image_changed = FALSE;\r\n\t\t\t\tif ((MPO_FULL_IMAGE or MPO_STEREO_IMAGE) and (chspic_ext($image_file)=='.mpo') and ($func != 'preview'))\r\n\t\t\t\t{\r\n\t\t\t\t\tif (!$image = chspic_mpo_image($source_img))\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\texit;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$image_changed = TRUE;\r\n\t\t\t\t}\r\n\t\t\t\telseif (!$image = imagecreatefromstring(file_get_contents($source_img)))\r\n\t\t\t\t{\r\n\t\t\t\t\texit;\r\n\t\t\t\t}\r\n\t\t\t\tif (($func == 'thumb') and ($image_dir != ICONS_DIR))\r\n\t\t\t\t{\r\n\t\t\t\t\tchspic_mkdir(DATA_ROOT.'info/'.$image_dir);\r\n\t\t\t\t\t$exif_info = '||||||';\r\n\t\t\t\t\tif (function_exists('exif_read_data'))\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif (SHOW_EXIF_INFO)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t$exif_data = exif_read_data(GALLERY_ROOT.$image_dir.$image_file, 'IFD0');\r\n\t\t\t\t\t\t\tif ($exif_data !== FALSE)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t$exif_info = '';\r\n\t\t\t\t\t\t\t\tif(isset($exif_data['DateTimeOriginal']))\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t$exif_time = explode(':', str_replace(' ', ':', $exif_data['DateTimeOriginal']));\r\n\t\t\t\t\t\t\t\t\t$exif_info .= mktime($exif_time[3], $exif_time[4], $exif_time[5], $exif_time[1], $exif_time[2], $exif_time[0]);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t$exif_info .= '|';\r\n\t\t\t\t\t\t\t\t$exif_info .= (isset($exif_data['Model'])?$exif_data['Model']:'').'|';\r\n\t\t\t\t\t\t\t\t$exif_info .= (isset($exif_data['ISOSpeedRatings'])?$exif_data['ISOSpeedRatings']:'').'|';\r\n\t\t\t\t\t\t\t\tif(isset($exif_data['ExposureTime']))\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t$exif_ExposureTime=create_function('','return '.$exif_data['ExposureTime'].';');\r\n\t\t\t\t\t\t\t\t\t$exp_time = $exif_ExposureTime();\r\n\t\t\t\t\t\t\t\t\tif ($exp_time > 0.25)\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t$exif_info .= $exp_time;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t$exif_info .= $exif_data['ExposureTime'];\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t$exif_info .= 's';\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t$exif_info .= '|';\r\n\t\t\t\t\t\t\t\tif(isset($exif_data['FNumber']))\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t$exif_FNumber=create_function('','return number_format(round('.$exif_data['FNumber'].',1),1);');\r\n\t\t\t\t\t\t\t\t\t$exif_info .= 'f'.$exif_FNumber();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t$exif_info .= '|';\r\n\t\t\t\t\t\t\t\tif(isset($exif_data['FocalLength']))\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t$exif_FocalLength=create_function('','return number_format(round('.$exif_data['FocalLength'].',1),1);');\r\n\t\t\t\t\t\t\t\t\t$exif_info .= $exif_FocalLength().'mm';\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t$exif_info .= '|';\r\n\t\t\t\t\t\t\t\tif(isset($exif_data['Flash']))\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t$exif_info .= (($exif_data['Flash'] & 1) ? TEXT_YES : TEXT_NO);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t$exif_info = 'chspic_no_exif_data_in_file||||||';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (ROTATE_IMAGES and isset($exif_data['Orientation']))\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t$image_width = imagesx($image);\r\n\t\t\t\t\t\t\t$image_height = imagesy($image);\r\n\t\t\t\t\t\t\tswitch ($exif_data['Orientation'])\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t$rotate = @imagecreatetruecolor($image_width, $image_height);\r\n\t\t\t\t\t\t\t\t\tif (LOW_IMAGE_RESAMPLE_QUALITY)\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\timagecopyresized($rotate, $image, 0, 0, $image_width-1, 0, $image_width, $image_height, -$image_width, $image_height);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\timagecopyresampled($rotate, $image, 0, 0, $image_width-1, 0, $image_width, $image_height, -$image_width, $image_height);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\timagedestroy($image);\r\n\t\t\t\t\t\t\t\t\t$image_changed = TRUE;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tcase 3:\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t$rotate = imagerotate($image, 180, 0);\r\n\t\t\t\t\t\t\t\t\timagedestroy($image);\r\n\t\t\t\t\t\t\t\t\t$image_changed = TRUE;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tcase 4:\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t$rotate = @imagecreatetruecolor($image_width, $image_height);\r\n\t\t\t\t\t\t\t\t\tif (LOW_IMAGE_RESAMPLE_QUALITY)\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\timagecopyresized($rotate, $image, 0, 0, 0, $image_height-1, $image_width, $image_height, $image_width, -$image_height);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\timagecopyresampled($rotate, $image, 0, 0, 0, $image_height-1, $image_width, $image_height, $image_width, -$image_height);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\timagedestroy($image);\r\n\t\t\t\t\t\t\t\t\t$image_changed = TRUE;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tcase 5:\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t$rotate = imagerotate($image, 270, 0);\r\n\t\t\t\t\t\t\t\t\timagedestroy($image);\r\n\t\t\t\t\t\t\t\t\t$image = $rotate;\r\n\t\t\t\t\t\t\t\t\t$rotate = @imagecreatetruecolor($image_height, $image_width);\r\n\t\t\t\t\t\t\t\t\tif (LOW_IMAGE_RESAMPLE_QUALITY)\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\timagecopyresized($rotate, $image, 0, 0, 0, $image_width-1, $image_height, $image_width, $image_height, -$image_width);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\timagecopyresampled($rotate, $image, 0, 0, 0, $image_width-1, $image_height, $image_width, $image_height, -$image_width);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t$image_changed = TRUE;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tcase 6:\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t$rotate = imagerotate($image, 270, 0);\r\n\t\t\t\t\t\t\t\t\timagedestroy($image);\r\n\t\t\t\t\t\t\t\t\t$image_changed = TRUE;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tcase 7:\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t$rotate = imagerotate($image, 90, 0);\r\n\t\t\t\t\t\t\t\t\timagedestroy($image);\r\n\t\t\t\t\t\t\t\t\t$image = $rotate;\r\n\t\t\t\t\t\t\t\t\t$rotate = @imagecreatetruecolor($image_height, $image_width);\r\n\t\t\t\t\t\t\t\t\tif (LOW_IMAGE_RESAMPLE_QUALITY)\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\timagecopyresized($rotate, $image, 0, 0, 0, $image_width-1, $image_height, $image_width, $image_height, -$image_width);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\timagecopyresampled($rotate, $image, 0, 0, 0, $image_width-1, $image_height, $image_width, $image_height, -$image_width);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t$image_changed = TRUE;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tcase 8:\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t$rotate = imagerotate($image, 90, 0);\r\n\t\t\t\t\t\t\t\t\timagedestroy($image);\r\n\t\t\t\t\t\t\t\t\t$image_changed = TRUE;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tdefault: $rotate = $image;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t$image = $rotate;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$iptc_info = '||||||||||||||||||';\r\n\t\t\t\t\tif(SHOW_IPTC_INFO)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$only_used_for_iptc = getimagesize(GALLERY_ROOT.$image_dir.$image_file, $info);\r\n\t\t\t\t\t\tif (isset($info['APP13']))\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t$iptc_info = '';\r\n\t\t\t\t\t\t\t$iptc = iptcparse($info['APP13']);\r\n\t\t\t\t\t\t\t$iptc_info .= (isset($iptc['2#005']) ? $iptc['2#005'][0] : '').'|';\r\n\t\t\t\t\t\t\t$iptc_info .= (isset($iptc['2#010']) ? $iptc['2#010'][0] : '').'|';\r\n\t\t\t\t\t\t\t$iptc_info .= (isset($iptc['2#015']) ? $iptc['2#015'][0] : '').'|';\r\n\t\t\t\t\t\t\t$iptc_info .= (isset($iptc['2#020']) ? $iptc['2#020'][0] : '').'|';\r\n\t\t\t\t\t\t\t$iptc_info .= (isset($iptc['2#040']) ? $iptc['2#040'][0] : '').'|';\r\n\t\t\t\t\t\t\t$iptc_info .= (isset($iptc['2#055']) ? $iptc['2#055'][0] : '').'|';\r\n\t\t\t\t\t\t\t$iptc_info .= (isset($iptc['2#080']) ? $iptc['2#080'][0] : '').'|';\r\n\t\t\t\t\t\t\t$iptc_info .= (isset($iptc['2#085']) ? $iptc['2#085'][0] : '').'|';\r\n\t\t\t\t\t\t\t$iptc_info .= (isset($iptc['2#090']) ? $iptc['2#090'][0] : '').'|';\r\n\t\t\t\t\t\t\t$iptc_info .= (isset($iptc['2#095']) ? $iptc['2#095'][0] : '').'|';\r\n\t\t\t\t\t\t\t$iptc_info .= (isset($iptc['2#101']) ? $iptc['2#101'][0] : '').'|';\r\n\t\t\t\t\t\t\t$iptc_info .= (isset($iptc['2#103']) ? $iptc['2#103'][0] : '').'|';\r\n\t\t\t\t\t\t\t$iptc_info .= (isset($iptc['2#105']) ? $iptc['2#105'][0] : '').'|';\r\n\t\t\t\t\t\t\t$iptc_info .= (isset($iptc['2#110']) ? $iptc['2#110'][0] : '').'|';\r\n\t\t\t\t\t\t\t$iptc_info .= (isset($iptc['2#115']) ? $iptc['2#115'][0] : '').'|';\r\n\t\t\t\t\t\t\t$iptc_info .= (isset($iptc['2#116']) ? $iptc['2#116'][0] : '').'|';\r\n\t\t\t\t\t\t\t$iptc_info .= (isset($iptc['2#120']) ? $iptc['2#120'][0] : '').'|';\r\n\t\t\t\t\t\t\t$iptc_info .= (isset($iptc['2#122']) ? $iptc['2#122'][0] : '').'|';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t$iptc_info = 'chspicnoiptc||||||||||||||||||';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (WATERMARK)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$wm_file = GALLERY_ROOT.ICONS_DIR.WATERMARK;\r\n\t\t\t\t\t\tif (file_exists($wm_file))\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tif ($watermark = imagecreatefromstring(file_get_contents($wm_file)))\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t$image_width = imagesx($image);\r\n\t\t\t\t\t\t\t\t$image_height = imagesy($image);\r\n\t\t\t\t\t\t\t\t$ww = imagesx($watermark);\r\n\t\t\t\t\t\t\t\t$wh = imagesy($watermark);\r\n\t\t\t\t\t\t\t\tif (WATERMARK_FRACTION)\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tif ($image_width < $image_height)\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t$ww_new = round($image_width * WATERMARK_FRACTION);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t$ww_new = round($image_height * WATERMARK_FRACTION);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t$wh_new = round($wh * ($ww_new / $ww));\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t$ww_new = $ww;\r\n\t\t\t\t\t\t\t\t\t$wh_new = $wh;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\timagecopyresampled ($image, $watermark, $image_width-$ww_new, $image_height-$wh_new, 0, 0, $ww_new, $wh_new, $ww, $wh);\r\n\t\t\t\t\t\t\t\timagedestroy($watermark);\r\n\t\t\t\t\t\t\t\t$image_changed = TRUE;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ($image_changed)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tchspic_mkdir(DATA_ROOT.'image/'.$image_dir);\r\n\t\t\t\t\t\t$new_full_img = DATA_ROOT.'image/'.$image_dir.$image_file;\r\n\t\t\t\t\t\tif ($image_type == 'jpeg')\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\timagejpeg($image, $new_full_img, IMAGE_JPEG_QUALITY);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telseif ($image_type == 'png')\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\timagepng($image, $new_full_img);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telseif ($image_type == 'gif')\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\timagegif($image, $new_full_img);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$fp = fopen(DATA_ROOT.'info/'.$image_dir.$image_file, 'w');\r\n\t\t\t\t\tfwrite($fp, filemtime(GALLERY_ROOT.$image_dir.$image_file).'|'.chspic_file_size(filesize(GALLERY_ROOT.$image_dir.$image_file)).'|'.imagesx($image).'|'.imagesy($image).'|'.$exif_info.'|'.$iptc_info);\r\n\t\t\t\t\tfclose($fp);\r\n\t\t\t\t}\r\n\t\t\t\tlist($new_img_width, $new_img_height) = chspic_aspect_resize(imagesx($image), imagesy($image), $max_width, $max_height, $enlarge);\r\n\t\t\t\tif(THUMB_SQUARE)\r\n\t\t\t\t{\r\n\t\t\t\t\t$new_img_width = $max_width;\r\n\t\t\t\t\t$new_img_height = $max_width;\r\n\t\t\t\t}\r\n\t\t\t\t$new_image = imagecreatetruecolor($new_img_width, $new_img_height);\r\n\t\t\t\tif (LOW_IMAGE_RESAMPLE_QUALITY)\r\n\t\t\t\t{\r\n\t\t\t\t\tif(THUMB_SQUARE)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$min_size = min(imagesx($image), imagesy($image));\r\n\t\t\t\t\t\timagecopyresized($new_image, $image, 0, 0, round((imagesx($image)- $min_size)/2), 0, $new_img_width, $new_img_height, $min_size, $min_size);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\timagecopyresized($new_image, $image, 0, 0, 0, 0, $new_img_width, $new_img_height, imagesx($image), imagesy($image));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tif(THUMB_SQUARE)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$min_size = min(imagesx($image), imagesy($image));\r\n\t\t\t\t\t\timagecopyresampled($new_image, $image, 0, 0, round((imagesx($image)- $min_size)/2), 0, $new_img_width, $new_img_height, $min_size, $min_size);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\timagecopyresampled($new_image, $image, 0, 0, 0, 0, $new_img_width, $new_img_height, imagesx($image), imagesy($image));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\timagedestroy($image);\r\n\t\t\t\tchspic_mkdir(DATA_ROOT.$func.'/'.$image_dir);\r\n\t\t\t\theader('Content-type: image/'.$image_type);\r\n\t\t\t\theader('Content-Disposition: filename=\"'.$func.'_'.$image_file.'\"');\r\n\t\t\t\tif ($image_type == 'jpeg')\r\n\t\t\t\t{\r\n\t\t\t\t\timagejpeg($new_image, NULL, $jpeg_quality);\r\n\t\t\t\t\timagejpeg($new_image, $image_path_file, $jpeg_quality);\r\n\t\t\t\t}\r\n\t\t\t\telseif ($image_type == 'png')\r\n\t\t\t\t{\r\n\t\t\t\t\timagepng($new_image);\r\n\t\t\t\t\timagepng($new_image, $image_path_file);\r\n\t\t\t\t}\r\n\t\t\t\telseif ($image_type == 'gif')\r\n\t\t\t\t{\r\n\t\t\t\t\timagegif($new_image);\r\n\t\t\t\t\timagegif($new_image, $image_path_file);\r\n\t\t\t\t}\r\n\t\t\t\timagedestroy($new_image);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tfunction chspic_dir_info($dir, $initial=TRUE)\r\n\t{\r\n\t\tlist($dirs, $images, $files, $misc) = chspic_get_dir($dir, TRUE);\r\n\t\tif ($initial)\r\n\t\t{\r\n\t\t\t$info = count($dirs).'|'.(int)(count($images)-$misc).'|'.count($files).'|'.filemtime(GALLERY_ROOT.GALLERY.'.').'|';\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$info = '';\r\n\t\t}\r\n\t\tif ((DIR_THUMB_FILE) and file_exists(GALLERY_ROOT.$dir.DIR_THUMB_FILE))\r\n\t\t{\r\n\t\t\treturn $info.chspic_url_string($dir, DIR_THUMB_FILE);\r\n\t\t}\r\n\t\tif (isset($images[0]))\r\n\t\t{\r\n\t\t\treturn $info.chspic_url_string($dir, $images[0]);\r\n\t\t}\r\n\t\tforeach ($dirs as $subdir)\r\n\t\t{\r\n\t\t\t$subresult = chspic_dir_info($dir.$subdir.'/', FALSE);\r\n\t\t\tif ($subresult != '')\r\n\t\t\t{\r\n\t\t\t\treturn $info.$subresult;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif ($initial and file_exists(GALLERY_ROOT.ICONS_DIR.DIR_THUMB_FILE))\r\n\t\t{\r\n\t\t\treturn $info.chspic_url_string(ICONS_DIR, DIR_THUMB_FILE);\r\n\t\t}\r\n\t\treturn $info;\r\n\t}\r\n\r\n\r\n\tfunction chspic_set_dir_info($dir)\r\n\t{\r\n\t\tif (!chspic_mkdir(DATA_ROOT.'info/'.$dir))\r\n\t\t{\r\n\t\t\tchspic_clean_data_root($dir);\r\n\t\t}\r\n\t\tif ($fp = fopen(DATA_ROOT.'info/'.$dir.'_chspic_dir', 'w'))\r\n\t\t{\r\n\t\t\tfwrite($fp, chspic_dir_info($dir));\r\n\t\t\tfclose($fp);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tfunction chspic_delete($element)\r\n\t{\r\n\t\tif (is_dir($element))\r\n\t\t{\r\n\t\t\t$items = array_diff(scandir($element),array('.','..'));\r\n\t\t\tforeach ($items as $item)\r\n\t\t\t{\r\n\t\t\t\tchspic_delete($element.\"/\".$item);\r\n\t\t\t}\r\n\t\t\trmdir($element);\r\n\t\t}\r\n\t\telseif (file_exists($element))\r\n\t\t{\r\n\t\t\tunlink($element);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tfunction chspic_delete_from_data_root($element)\r\n\t{\r\n\t\tchspic_delete(DATA_ROOT.'info/'.$element);\r\n\t\tchspic_delete(DATA_ROOT.'thumb/'.$element);\r\n\t\tchspic_delete(DATA_ROOT.'image/'.$element);\r\n\t\tchspic_delete(DATA_ROOT.'preview/'.$element);\r\n\t}\r\n\r\n\r\n\tfunction chspic_clean_data_root($dir)\r\n\t{\r\n\t\t$items = array_diff(scandir(DATA_ROOT.'info/'.$dir),array('.','..','_chspic_dir'));\r\n\t\tforeach($items as $item)\r\n\t\t{\r\n\t\t\tif (!is_dir(GALLERY_ROOT.$dir.$item) and !file_exists(GALLERY_ROOT.$dir.$item))\r\n\t\t\t{\r\n\t\t\t\tchspic_delete_from_data_root($dir.$item);\r\n\t\t\t}\r\n\t\t}\r\n\t\t$path='';\r\n\t\t$dirs=explode('/',$dir);\r\n\t\tforeach($dirs as $dirout)\r\n\t\t{\r\n\t\t\tif(file_exists(DATA_ROOT.'info/'.$path.'_chspic_dir'))\r\n\t\t\t{\r\n\t\t\t\tunlink(DATA_ROOT.'info/'.$path.'_chspic_dir');\r\n\t\t\t}\r\n\t\t\t$path.=$dirout.'/';\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tfunction chspic_random($nr)\r\n\t{\r\n\t\t$a='0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\r\n\t\t$res='';\r\n\t\tfor($i = 0; $i<$nr; $i++)\r\n\t\t{\r\n\t\t\t$res.=$a[mt_rand(0,strlen($a)-1)];\r\n\t\t}\r\n\t\treturn $res;\r\n\t}\r\n\r\n\r\n\tfunction chspic_javascript()\r\n\t{\r\n\t\tglobal $dirs, $images, $files, $misc;\r\n\t\techo \"<script>\r\n\t\t<!--\r\n\r\n\t\tvar phpSelf = '\".$_SERVER[\"PHP_SELF\"].\"';\r\n\r\n\t\tvar navLink = [];\r\n\t\tvar navName = [];\r\n\r\n\t\tvar dirLink = [];\r\n\t\tvar dirThumb = [];\r\n\t\tvar dirName = [];\r\n\t\tvar dirInfo = [];\r\n\r\n\t\tvar imgLink = [];\r\n\t\tvar imgName = [];\r\n\t\tvar imgInfo = [];\r\n\t\tvar imgSell = [];\r\n\r\n\t\tvar fileLink = [];\r\n\t\tvar fileThumb = [];\r\n\t\tvar fileName = [];\r\n\t\tvar fileInfo = [];\r\n\r\n\t\tvar imageSpace = 50;\r\n\t\tvar slideshowActive = false;\r\n\t\tvar slideshowSec = 0;\r\n\r\n\t\tvar waitSpin = ['&bull;-----', '-&bull;----', '--&bull;---', '---&bull;--', '----&bull;-', '-----&bull;'];\r\n\t\tvar waitSpinNr = 0;\r\n\t\tvar waitSpinSpeed = 100;\r\n\r\n\t\tvar showInfo = \".(TEXT_INFO?((isset($_GET[\"info\"]) ? (($_GET[\"info\"]=='1') ? \"true\" : \"false\") : (SHOW_INFO_BY_DEFAULT ? \"true\" : \"false\"))):\"false\").\";\r\n\r\n\t\tvar actualSize = false;\r\n\t\tvar fullImgLoaded = false;\r\n\t\tvar imageLargerThanViewport = false;\r\n\t\tvar naviOk = true;\r\n\t\tvar index = false;\r\n\t\tvar preloadImg = new Image();\r\n\t\tvar preloaded = -1;\r\n\t\tvar preloadedFull = -1;\r\n\r\n\t\tvar viewportWidth;\r\n\t\tvar viewportHeight;\r\n\t\tvar imgFullWidth;\r\n\t\tvar imgFullHeight;\r\n\t\t\r\n\t\tvar selectedDirs = [];\r\n\t\tvar selectedImages = [];\r\n\t\tvar selectedFiles = [];\r\n\t\tvar selecting = false;\r\n\t\tvar itd = isTouchDevice();\r\n\r\n\t\t\";\r\n\t\tif (KEYBOARD_NAVIGATION)\r\n\t\t{\r\n\t\t\techo\"\r\n\t\t\tfunction keyNavigate(key)\r\n\t\t\t{\r\n\t\t\t\tif (!selecting)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar k = (window.event) ? event.keyCode : key.keyCode;\r\n\t\t\t\t\tif (index)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif (k==33 || k==38 || k==37) /// Page up, Arrow up, Arrow left\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tcycleImg(-1);\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if (k==32 || k==34 || k==39 || k==40) /// Space, Page down, Arrow right, Arrow down\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tcycleImg(1);\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if (k==27) /// Esc\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tcloseImageView();\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif (k==27 && navLink.length>2) /// Esc\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tdocument.location=phpSelf+'?chspic='+navLink[navLink.length-3]+(showInfo?'&info=1':'');\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tdocument.onkeyup = keyNavigate;\t\";\r\n\t\t}\r\n\t\techo\"\r\n\r\n\t\tfunction gebi(id)\r\n\t\t{\r\n\t\t\treturn document.getElementById(id);\r\n\t\t}\r\n\r\n\r\n\t\tfunction isTouchDevice()\r\n\t\t{\r\n\t\t\tvar userAgent = window.navigator.userAgent;\r\n\t\t\tif ((userAgent.match(/iPad/i) || userAgent.match(/iPhone/i)))\r\n\t\t\t{\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\r\n\t\tfunction getViewport()\r\n\t\t{\r\n\t\t\tif (typeof window.innerWidth != 'undefined')\r\n\t\t\t{\r\n\t\t\t\tviewportWidth = window.innerWidth,\r\n\t\t\t\tviewportHeight = window.innerHeight\r\n\t\t\t}\r\n\t\t\telse if (typeof document.documentElement != 'undefined' && typeof document.documentElement.clientWidth != 'undefined' && document.documentElement.clientWidth != 0)\r\n\t\t\t{\r\n\t\t\t\tviewportWidth = document.documentElement.clientWidth,\r\n\t\t\t\tviewportHeight = document.documentElement.clientHeight\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tviewportWidth = document.getElementsByTagName('body')[0].clientWidth,\r\n\t\t\t\tviewportHeight = document.getElementsByTagName('body')[0].clientHeight\r\n\t\t\t}\r\n\t\t\tif (showInfo)\r\n\t\t\t{\r\n\t\t\t\tviewportWidth -= (\".INFO_BOX_WIDTH.\" + 12);\r\n\t\t\t}\r\n\t\t\tviewportHeight -= \".MENU_BOX_HEIGHT.\";\r\n\t\t\tif (viewportHeight < 0) viewportHeight = 20;\r\n\t\t}\r\n\r\n\r\n\t\tfunction initDisplay()\r\n\t\t{\r\n\t\t\tgetViewport();\r\n\t\t\tif (index)\r\n\t\t\t{\r\n\t\t\t\tresizeImage();\r\n\t\t\t}\r\n\t\t\tvar thirdWidth=Math.round((viewportWidth-40)/3);\r\n\t\t\tgebi('box_image').style.width = viewportWidth+'px';\r\n\t\t\tgebi('box_image').style.height = viewportHeight+'px';\r\n\t\t\tgebi('box_wait').style.width = viewportWidth+'px';\r\n\t\t\tgebi('box_wait').style.height = viewportHeight+'px';\r\n\t\t\tgebi('box_gallery').style.width = viewportWidth+'px';\r\n\t\t\tgebi('box_gallery').style.height = viewportHeight+'px';\r\n\t\t\tgebi('box_info').style.height = (viewportHeight-20)+'px';\r\n\t\t\tgebi('box_left').style.width = thirdWidth+'px';\r\n\t\t\tgebi('box_left').style.height = (viewportHeight-40)+'px';\r\n\t\t\tgebi('box_left').style.right = (thirdWidth*2+20)+'px';\r\n\t\t\tgebi('box_right').style.width = thirdWidth+'px';\r\n\t\t\tgebi('box_right').style.height = (viewportHeight-40)+'px';\r\n\t\t\tgebi('box_right').style.right = 20+'px';\r\n\t\t\tshowMenu();\r\n\t\t}\r\n\r\n\r\n\t\tfunction resizeImage()\r\n\t\t{\r\n\t\t\tvar availX, availY, aspectX, aspectY, newImgX, newImgY;\r\n\t\t\tavailX = viewportWidth - imageSpace;\r\n\t\t\tavailY = viewportHeight - imageSpace;\r\n\t\t\tif (availX < \".THUMB_MAX_WIDTH.\")\r\n\t\t\t{\r\n\t\t\t\tavailX = \".THUMB_MAX_WIDTH.\";\r\n\t\t\t}\r\n\t\t\tif (availY < \".THUMB_MAX_HEIGHT.\")\r\n\t\t\t{\r\n\t\t\t\tavailY = \".THUMB_MAX_HEIGHT.\";\r\n\t\t\t}\r\n\t\t\tif ((imgFullWidth > availX) || (imgFullHeight > availY))\r\n\t\t\t{\r\n\t\t\t\timageLargerThanViewport = true;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\timageLargerThanViewport = false;\r\n\t\t\t}\r\n\t\t\tif (!actualSize && ((imgFullWidth > availX) || (imgFullHeight > availY)))\r\n\t\t\t{\r\n\t\t\t\taspectX = imgFullWidth / availX;\r\n\t\t\t\taspectY = imgFullHeight / availY;\r\n\t\t\t\tif (aspectX > aspectY)\r\n\t\t\t\t{\r\n\t\t\t\t\tnewImgX = availX;\r\n\t\t\t\t\tnewImgY = Math.round(imgFullHeight / aspectX);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tnewImgX = Math.round(imgFullWidth / aspectY);\r\n\t\t\t\t\tnewImgY = availY;\r\n\t\t\t\t}\r\n\t\t\t\tgebi('img_resize').innerHTML = newImgX + ' x ' + newImgY;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tnewImgX = imgFullWidth;\r\n\t\t\t\tnewImgY = imgFullHeight;\r\n\t\t\t\tgebi('img_resize').innerHTML = '\".sts(TEXT_NOT_SCALED).\"';\r\n\t\t\t}\r\n\t\t\tgebi('img_size').innerHTML = imgFullWidth + ' x ' + imgFullHeight;\r\n\t\t\tgebi('full').width = newImgX;\r\n\t\t\tgebi('full').height = newImgY;\r\n\t\t}\r\n\r\n\r\n\t\tfunction fullSize()\r\n\t\t{\r\n\t\t\tif (actualSize == true)\r\n\t\t\t{\r\n\t\t\t\tactualSize = false;\r\n\t\t\t\tinitDisplay();\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tactualSize = true;\r\n\t\t\t\tinitDisplay();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tfunction showMenu()\r\n\t\t{\r\n\t\t\tif ((imgLink.length>0)&&naviOk)\r\n\t\t\t{\r\n\t\t\t\tmenu = '<span id=\\\"button_left\\\" class=\\\"chspic_button\\\" onclick=\\\"cycleImg(-1)\\\">\".sts(TEXT_PREVIOUS).\"</span>';\r\n\t\t\t\tif (index)\r\n\t\t\t\t{\r\n\t\t\t\t\tmenu += '<span id=\\\"button_close\\\" class=\\\"chspic_button\\\" onclick=\\\"closeImageView()\\\">\".sts(TEXT_CLOSE_IMG_VIEW).\"</span>';\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tmenu += '<span class=\\\"chspic_button_disabled\\\">\".sts(TEXT_CLOSE_IMG_VIEW).\"</span>';\r\n\t\t\t\t}\r\n\t\t\t\tmenu += '<span id=\\\"button_right\\\" class=\\\"chspic_button\\\" onclick=\\\"cycleImg(1)\\\">\".sts(TEXT_NEXT).\"</span>';\r\n\t\t\t\t\";\r\n\t\t\t\tif (TEXT_SLIDESHOW)\r\n\t\t\t\t{\r\n\t\t\t\t\techo\"\r\n\t\t\t\t\tif (slideshowActive)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tmenu += '<span class=\\\"chspic_button_on\\\" onclick=\\\"slideshowActive=false; showMenu();\\\">\".sts(TEXT_SLIDESHOW).\"</span>';\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tmenu += '<span class=\\\"chspic_button\\\" onclick=\\\"slideshowActive=true; showMenu(); slideshow(true);\\\">\".sts(TEXT_SLIDESHOW).\"</span>';\r\n\t\t\t\t\t}\";\r\n\t\t\t\t}\r\n\t\t\t\techo \"\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tmenu = '<span class=\\\"chspic_button_disabled\\\">\".sts(TEXT_PREVIOUS).\"</span>';\r\n\t\t\t\tmenu += '<span class=\\\"chspic_button_disabled\\\">\".sts(TEXT_CLOSE_IMG_VIEW).\"</span>';\r\n\t\t\t\tmenu += '<span class=\\\"chspic_button_disabled\\\">\".sts(TEXT_NEXT).\"</span>';\r\n\t\t\t\t\".(TEXT_SLIDESHOW ? \"menu += '<span class=\\\"chspic_button_disabled\\\">\" . sts(TEXT_SLIDESHOW) . \"</span>';\" : \"\").\"\r\n\t\t\t}\";\r\n\t\t\tif (TEXT_INFO)\r\n\t\t\t{\r\n\t\t\t\techo \"\r\n\t\t\t\tif (showInfo)\r\n\t\t\t\t{\r\n\t\t\t\t\tmenu += '<span onclick=\\\"toggleInfo(showInfo);\\\" class=\\\"chspic_button_on\\\">\".sts(TEXT_INFO).\"</span>';\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tmenu += '<span onclick=\\\"toggleInfo(showInfo);\\\" class=\\\"chspic_button\\\">\".sts(TEXT_INFO).\"</span>';\r\n\t\t\t\t}\";\r\n\t\t\t}\r\n\t\t\techo \"\r\n\t\t\tif (index && imageLargerThanViewport)\r\n\t\t\t{\r\n\t\t\t\tif (actualSize)\r\n\t\t\t\t{\r\n\t\t\t\t\tmenu += '<span class=\\\"chspic_button_on\\\" onclick=\\\"fullSize()\\\">\".sts(TEXT_ACTUAL_SIZE).\"</span>';\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tmenu += '<span class=\\\"chspic_button\\\" onclick=\\\"fullSize()\\\">\".sts(TEXT_ACTUAL_SIZE).\"</span>';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tmenu += '<span class=\\\"chspic_button_disabled\\\">\".sts(TEXT_ACTUAL_SIZE).\"</span>';\r\n\t\t\t}\r\n\r\n\r\n\t\t\t\";\r\n\t\t\tif (USE_PREVIEW)\r\n\t\t\t{\r\n\t\t\t\techo \"\r\n\t\t\t\tif (index)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (fullImgLoaded)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tmenu += '<span class=\\\"chspic_button_on\\\" onclick=\\\"openImageView('+index+', false)\\\">\".sts(TEXT_FULLRES).\"</span>';\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tmenu += '<span class=\\\"chspic_button\\\" onclick=\\\"openImageView('+index+', true)\\\">\".sts(TEXT_FULLRES).\"</span>';\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tmenu += '<span class=\\\"chspic_button_disabled\\\">\".sts(TEXT_FULLRES).\"</span>';\r\n\t\t\t\t}\r\n\t\t\t\t\";\r\n\t\t\t}\r\n\t\t\tif (LINK_BACK)\r\n\t\t\t{\r\n\t\t\t\techo \"menu += '<span class=\\\"chspic_button\\\" onclick=\\\"window.location=\\'\".LINK_BACK.\"\\'\\\">\".sts(TEXT_LINK_BACK).\"</span>';\r\n\t\t\t\t\";\r\n\t\t\t}\r\n\t\t\tif (PASSWORD!=='')\r\n\t\t\t{\r\n\t\t\t\techo \"menu += '<span class=\\\"chspic_button\\\" onclick=\\\"window.location=\\'\".$_SERVER['PHP_SELF'].\"?cmd=logout\\'\\\">\".sts(TEXT_LOGOUT).\"</span>';\";\r\n\t\t\t}\r\n\t\t\tif (ADMIN===TRUE)\r\n\t\t\t{\r\n\t\t\t\techo\"\r\n\t\t\t\t\tif (selecting)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tmenu = '<span class=\\\"chspic_button\\\" onclick=\\\"admDelete()\\\">\".sts(TEXT_DELETE).\"</span>';\r\n\t\t\t\t\t\tmenu += '<span class=\\\"chspic_button\\\" onclick=\\\"admRename()\\\">\".sts(TEXT_RENAME).\"</span>';\r\n\t\t\t\t\t\tmenu += '<span class=\\\"chspic_button\\\" onclick=\\\"admMove()\\\">\".sts(TEXT_MOVE).\"</span>';\r\n\t\t\t\t\t\tmenu += '<span class=\\\"chspic_button\\\" onclick=\\\"admMakeDir()\\\">\".sts(TEXT_MKDIR).\"</span>';\r\n\t\t\t\t\t\tmenu += '<span class=\\\"chspic_button\\\" onclick=\\\"admUpload(true)\\\">\".sts(TEXT_UPLOAD).\"</span>';\r\n\t\t\t\t\t\tmenu += '<span class=\\\"chspic_button\\\" onclick=\\\"admDesc()\\\">\".sts(TEXT_DESCRIPTION).\"</span>';\r\n\t\t\t\t\t\tmenu += '<span class=\\\"chspic_button\\\" onclick=\\\"admSell()\\\">\".sts(TEXT_PAYPAL_FOR_SALE).\"</span>';\r\n\t\t\t\t\t\tmenu += '<span class=\\\"chspic_button_on\\\" onclick=\\\"toggleSelect()\\\">\".sts(TEXT_ADMIN).\"</span>';\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tmenu += '<span class=\\\"chspic_button\\\" onclick=\\\"toggleSelect()\\\">\".sts(TEXT_ADMIN).\"</span>';\r\n\t\t\t\t\t}\r\n\t\t\t\t\";\r\n\t\t\t}\r\n\t\t\techo\"\r\n\t\t\tgebi('div_menu').innerHTML = menu;\r\n\t\t}\r\n\r\n\r\n\t\tfunction openImageView(imgId, full)\r\n\t\t{\r\n\t\t\tif (!index)\r\n\t\t\t{\r\n\t\t\t\tgebi('box_overlay').style.visibility='visible';\r\n\t\t\t\tsetOpacity('box_overlay', \".OVERLAY_OPACITY.\");\r\n\t\t\t}\r\n\t\t\tindex = imgId;\r\n\t\t\tfillInfo('img', index);\r\n\t\t\tsetOpacity('full', 0);\r\n\t\t\tgebi('wait').style.visibility='visible';\r\n\t\t\tgebi('box_wait').style.visibility='visible';\r\n\t\t\tgebi('box_image').style.visibility='visible';\r\n\t\t\tgebi('box_left').style.visibility='visible';\r\n\t\t\tgebi('box_right').style.visibility='visible';\r\n\t\t\tpreloadImage(index, full);\r\n\t\t\tactualSize = false;\r\n\t\t\tfullImgLoaded = full;\r\n\t\t\tshowMenu();\r\n\t\t\tshowImage(0);\r\n\t\t}\r\n\r\n\r\n\t\tfunction preloadImage(imgId, full)\r\n\t\t{\r\n\t\t\tif ((preloaded != imgId) || (preloadedFull != full))\r\n\t\t\t{\r\n\t\t\t\tpreloadImg = new Image();\r\n\t\t\t\tif ((full == 1) || (\".(USE_PREVIEW ? \"false\" : \"true\").\"))\r\n\t\t\t\t{\r\n\t\t\t\t\tpreloadImg.src = '';\r\n\t\t\t\t\tpreloadImg.src = phpSelf+'?cmd=image&chspic='+imgLink[imgId];\r\n\t\t\t\t\tpreloadedFull = 1;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tpreloadImg.src = '';\r\n\t\t\t\t\tpreloadImg.src = phpSelf+'?cmd=preview&chspic='+imgLink[imgId];\r\n\t\t\t\t\tpreloadedFull = 0;\r\n\t\t\t\t}\r\n\t\t\t\tpreloaded = imgId;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\";\r\n\t\t$date_format = str_replace('Year', \"'+year+'\", DATE_FORMAT);\r\n\t\t$date_format = str_replace('Nrmonth', \"'+nrmon+'\", $date_format);\r\n\t\t$date_format = str_replace('Month', \"'+month+'\", $date_format);\r\n\t\t$date_format = str_replace('Date', \"'+date+'\", $date_format);\r\n\t\t$date_format = str_replace('Hour', \"'+hour+'\", $date_format);\r\n\t\t$date_format = str_replace('Min', \"'+min+'\", $date_format);\r\n\t\t$date_format = str_replace('Sec', \"'+sec+'\", $date_format);\r\n\t\t$date_format = str_replace('Day', \"'+day+'\", $date_format);\r\n\t\techo\"\r\n\t\tfunction dateFormat(timestamp)\r\n\t\t{\r\n\t\t\tvar dt = new Date(timestamp*1000);\r\n\t\t\tvar months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];\r\n\t\t\tvar days = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];\r\n\t\t\tvar year = dt.getFullYear();\r\n\t\t\tvar nrmon = dt.getMonth()+1;\r\n\t\t\tvar month = months[dt.getMonth()];\r\n\t\t\tvar date = dt.getDate();\r\n\t\t\tvar hour = (dt.getHours()<10?'0'+dt.getHours():dt.getHours());\r\n\t\t\tvar min = (dt.getMinutes()<10?'0'+dt.getMinutes():dt.getMinutes());\r\n\t\t\tvar sec = (dt.getSeconds()<10?'0'+dt.getSeconds():dt.getSeconds());\r\n\t\t\tvar day = days[dt.getDay()];\r\n\t\t\treturn '\".$date_format.\"';\r\n\t\t}\r\n\r\n\r\n\t\tfunction fillInfo(type, id)\r\n\t\t{\r\n\t\t\tif (!index || (type == 'img'))\r\n\t\t\t{\r\n\t\t\t\tvar info='<div class=\\\"thumbimgbox\\\">';\r\n\t\t\t\tif (type == 'dir')\r\n\t\t\t\t{\r\n\t\t\t\t\tif (dirThumb[id] != '')\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tinfo += '<img class=\\\"thumb\\\" alt=\\\"\\\" src=\\\"'+phpSelf+'?cmd=thumb&chspic='+dirThumb[id]+'\\\">';\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tinfo += '<br><br>\".sts(TEXT_NO_IMAGES).\"';\r\n\t\t\t\t\t}\r\n\t\t\t\t\tinfo += '</div>';\r\n\t\t\t\t\tinfo += '<strong>\".sts(TEXT_DIR_NAME).\"</strong><br><div class=\\\"chspic_info_text\\\">'+dirName[id] + '</div><br>';\r\n\t\t\t\t\tvar splint = dirInfo[id].split('|');\r\n\t\t\t\t\t\".(DIR_DESC_IN_INFO?\"info += '<strong>\".sts(TEXT_DESCRIPTION).\"</strong><br><div class=\\\"chspic_info_text\\\">'+splint[4]+'<br></div><br>';\":\"\").\"\r\n\t\t\t\t\tinfo += '<strong>\".sts(TEXT_INFO).\"</strong><br><div class=\\\"chspic_info_text\\\">';\r\n\t\t\t\t\tinfo += '\".sts(TEXT_DATE).\": '+dateFormat(splint[0])+'<br>';\r\n\t\t\t\t\tinfo += '\".sts(TEXT_DIRS).\": '+splint[1]+'<br>';\r\n\t\t\t\t\tinfo += '\".sts(TEXT_IMAGES).\": '+splint[2]+'<br>';\";\r\n\t\t\t\t\tif (SHOW_FILES)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\techo \"\r\n\t\t\t\t\t\tinfo += '\".sts(TEXT_FILES).\": '+splint[3]+'<br>';\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\techo \"\r\n\t\t\t\t\tinfo += '</div><br>';\r\n\t\t\t\t\tinfo += '<strong>\".sts(TEXT_LINKS).\"</strong><br><a href=\\\"'+phpSelf+'?chspic='+dirLink[id]+'\\\">\".sts(TEXT_DIRECT_LINK_GALLERY).\"</a><br><br>';\r\n\t\t\t\t}\r\n\t\t\t\telse if (type == 'img')\r\n\t\t\t\t{\r\n\t\t\t\t\tinfo += '<img class=\\\"thumb\\\" alt=\\\"\\\" src=\\\"'+phpSelf+'?cmd=thumb&chspic='+imgLink[id]+'\\\">';\r\n\t\t\t\t\tinfo += '</div>';\r\n\t\t\t\t\tvar splint = imgInfo[id].split('|');\r\n\t\t\t\t\tinfo += '<strong>\".sts(TEXT_IMAGE_NAME).\"</strong><br><div class=\\\"chspic_info_text\\\">'+imgName[id] + '</div><br>';\r\n\t\t\t\t\t\";\r\n\t\t\t\t\tif(PAYPAL_ENABLED)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\techo\"\r\n\t\t\t\t\t\tif (typeof imgSell[id]!='undefined')\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tvar sellSplint = imgSell[id].split('|');\r\n\t\t\t\t\t\t\tinfo += '<strong>\".sts(TEXT_PAYPAL_FOR_SALE).\"</strong><br><div class=\\\"chspic_info_text\\\">';\r\n\t\t\t\t\t\t\tinfo += '\".sts(TEXT_PAYPAL_PRICE).\": '+(((typeof sellSplint[0]!='undefined')&&(sellSplint[0]!=''))?sellSplint[0]:'\".sts(TEXT_PAYPAL_NO_PRICE).\"')+'<br>';\r\n\t\t\t\t\t\t\tinfo += '\".sts(TEXT_PAYPAL_IN_STOCK).\": '+(((typeof sellSplint[1]!='undefined')&&(sellSplint[1]!=''))?sellSplint[1]:'\".sts(TEXT_PAYPAL_OUT_OF_STOCK).\"')+'<br>';\r\n\t\t\t\t\t\t\tinfo += '\".sts(TEXT_PAYPAL_ITEM_ID).\": '+sellSplint[2]+'<br>';\r\n\t\t\t\t\t\t\tif ((typeof sellSplint[1]!='undefined')&&(sellSplint[1]>0)&&(typeof sellSplint[0]!='undefined')&&(sellSplint[0]!=''))\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tinfo += '<br><span onclick=\\\"window.location=\\''+phpSelf+'?cmd=buy&chspic='+imgLink[id]+'\\'\\\" class=\\\"chspic_button\\\">\".sts(TEXT_PAYPAL_BUY).\"</span><br><br>';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tinfo += '<br><span class=\\\"chspic_button_disabled\\\">\".sts(TEXT_PAYPAL_BUY).\"</span><br><br>';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tinfo += '</div><br>';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\techo\"\r\n\t\t\t\t\tif (typeof splint[10] != 'undefined')\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tinfo += '<strong>\".sts(TEXT_DESCRIPTION).\"</strong><br><div class=\\\"chspic_info_text\\\">';\r\n\t\t\t\t\t\tinfo += splint[29]+'<br>';\r\n\t\t\t\t\t\tinfo += '</div><br>';\r\n\t\t\t\t\t\tinfo += '<strong>\".sts(TEXT_INFO).\"</strong><br><div class=\\\"chspic_info_text\\\">';\r\n\t\t\t\t\t\tinfo += '\".sts(TEXT_DATE).\": '+dateFormat(splint[0])+'<br>';\r\n\t\t\t\t\t\tinfo += '\".sts(TEXT_IMAGESIZE).\": '+splint[2]+' x '+splint[3]+'<br>';\r\n\t\t\t\t\t\tinfo += '\".sts(TEXT_DISPLAYED_IMAGE).\": <span id=\\\"img_size\\\"></span> (';\r\n\t\t\t\t\t\tif (fullImgLoaded || \".(USE_PREVIEW ? \"false\" : \"true\").\")\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tinfo += '\".sts(TEXT_THIS_IS_FULL).\"';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tinfo += '\".sts(TEXT_THIS_IS_PREVIEW).\"';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tinfo += ')<br>';\r\n\t\t\t\t\t\tinfo += '\".sts(TEXT_SCALED_TO).\": <span id=\\\"img_resize\\\"></span><br>';\r\n\t\t\t\t\t\tinfo += '\".sts(TEXT_FILESIZE).\": '+splint[1]+'<br>';\r\n\t\t\t\t\t\tinfo += '\".sts(TEXT_IMAGE_NUMBER).\": '+id+' / '+(imgLink.length-1)+'<br>';\r\n\t\t\t\t\t\tinfo += '</div><br>';\";\r\n\t\t\t\t\t\tif (SHOW_EXIF_INFO)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\techo\"\r\n\t\t\t\t\t\t\tinfo += '<strong>\".sts(TEXT_EXIF).\"</strong><br><div class=\\\"chspic_info_text\\\">';\r\n\t\t\t\t\t\t\tif (splint[4] == 'chspic_no_exif_data_in_file')\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tinfo += '\".sts(TEXT_EXIF_MISSING).\"';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tvar exifInfo = (splint[4]!=''?'\".sts(TEXT_EXIF_DATE).\": '+dateFormat(splint[4])+'<br>':'');\r\n\t\t\t\t\t\t\t\texifInfo += (splint[5]!=''?'\".sts(TEXT_EXIF_CAMERA).\": '+splint[5]+'<br>':'');\r\n\t\t\t\t\t\t\t\texifInfo += (splint[6]!=''?'\".sts(TEXT_EXIF_ISO).\": '+splint[6]+'<br>':'');\r\n\t\t\t\t\t\t\t\texifInfo += (splint[7]!=''?'\".sts(TEXT_EXIF_SHUTTER).\": '+splint[7]+'<br>':'');\r\n\t\t\t\t\t\t\t\texifInfo += (splint[8]!=''?'\".sts(TEXT_EXIF_APERTURE).\": '+splint[8]+'<br>':'');\r\n\t\t\t\t\t\t\t\texifInfo += (splint[9]!=''?'\".sts(TEXT_EXIF_FOCAL).\": '+splint[9]+'<br>':'');\r\n\t\t\t\t\t\t\t\texifInfo += (splint[10]!=''?'\".sts(TEXT_EXIF_FLASH).\": '+splint[10]+'<br>':'');\r\n\t\t\t\t\t\t\t\tif (exifInfo != '')\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tinfo += exifInfo;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tinfo += '\".sts(TEXT_EXIF_MISSING).\"';\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tinfo += '</div><br>';\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (SHOW_IPTC_INFO)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\techo\"\r\n\t\t\t\t\t\t\tinfo += '<strong>\".sts(TEXT_IPTC).\"</strong><br><div class=\\\"chspic_info_text\\\">';\r\n\t\t\t\t\t\t\tif (splint[11] == 'chspicnoiptc')\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tinfo += '\".sts(TEXT_IPTC_MISSING).\"';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tvar iptcInfo = (splint[11]!=''?'\".sts(TEXT_IPTC_TITLE).\": '+splint[11]+'<br>':'');\r\n\t\t\t\t\t\t\t\tiptcInfo += (splint[12]!=''?'\".sts(TEXT_IPTC_URGENCY).\": '+splint[12]+'<br>':'');\r\n\t\t\t\t\t\t\t\tiptcInfo += (splint[13]!=''?'\".sts(TEXT_IPTC_CATEGORY).\": '+splint[13]+'<br>':'');\r\n\t\t\t\t\t\t\t\tiptcInfo += (splint[14]!=''?'\".sts(TEXT_IPTC_SUBCATEGORIES).\": '+splint[14]+'<br>':'');\r\n\t\t\t\t\t\t\t\tiptcInfo += (splint[15]!=''?'\".sts(TEXT_IPTC_SPECIALINSTRUCTIONS).\": '+splint[15]+'<br>':'');\r\n\t\t\t\t\t\t\t\tiptcInfo += (splint[16]!=''?'\".sts(TEXT_IPTC_CREATIONDATE).\": '+splint[16]+'<br>':'');\r\n\t\t\t\t\t\t\t\tiptcInfo += (splint[17]!=''?'\".sts(TEXT_IPTC_AUTHORBYLINE).\": '+splint[17]+'<br>':'');\r\n\t\t\t\t\t\t\t\tiptcInfo += (splint[18]!=''?'\".sts(TEXT_IPTC_AUTHORTITLE).\": '+splint[18]+'<br>':'');\r\n\t\t\t\t\t\t\t\tiptcInfo += (splint[19]!=''?'\".sts(TEXT_IPTC_CITY).\": '+splint[19]+'<br>':'');\r\n\t\t\t\t\t\t\t\tiptcInfo += (splint[20]!=''?'\".sts(TEXT_IPTC_STATE).\": '+splint[20]+'<br>':'');\r\n\t\t\t\t\t\t\t\tiptcInfo += (splint[21]!=''?'\".sts(TEXT_IPTC_COUNTRY).\": '+splint[21]+'<br>':'');\r\n\t\t\t\t\t\t\t\tiptcInfo += (splint[22]!=''?'\".sts(TEXT_IPTC_OTR).\": '+splint[22]+'<br>':'');\r\n\t\t\t\t\t\t\t\tiptcInfo += (splint[23]!=''?'\".sts(TEXT_IPTC_HEADLINE).\": '+splint[23]+'<br>':'');\r\n\t\t\t\t\t\t\t\tiptcInfo += (splint[24]!=''?'\".sts(TEXT_IPTC_SOURCE).\": '+splint[24]+'<br>':'');\r\n\t\t\t\t\t\t\t\tiptcInfo += (splint[25]!=''?'\".sts(TEXT_IPTC_PHOTOSOURCE).\": '+splint[25]+'<br>':'');\r\n\t\t\t\t\t\t\t\tiptcInfo += (splint[26]!=''?'\".sts(TEXT_IPTC_COPYRIGHT).\": '+splint[26]+'<br>':'');\r\n\t\t\t\t\t\t\t\tiptcInfo += (splint[27]!=''?'\".sts(TEXT_IPTC_CAPTION).\": '+splint[27]+'<br>':'');\r\n\t\t\t\t\t\t\t\tiptcInfo += (splint[28]!=''?'\".sts(TEXT_IPTC_CAPTIONWRITER).\": '+splint[28]+'<br>':'');\r\n\t\t\t\t\t\t\t\tif (iptcInfo != '')\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tinfo += iptcInfo;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tinfo += '\".sts(TEXT_IPTC_MISSING).\"';\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tinfo += '</div><br>';\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\techo\"\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tinfo += '<br><strong>\".sts(TEXT_FIRST_VIEW).\"</strong><br><br><span id=\\\"img_size\\\"></span><span id=\\\"img_resize\\\"></span><br><br>';\r\n\t\t\t\t\t}\r\n\t\t\t\t\tinfo += '<strong>\".sts(TEXT_LINKS).\"</strong><br>';\r\n\t\t\t\t\tinfo += '<a href=\\\"'+phpSelf+'?chspic='+imgLink[id]+'\\\">\".sts(TEXT_DIRECT_LINK_IMAGE).\"</a><br>';\r\n\t\t\t\t\t\".(TEXT_DOWNLOAD ? \"info += '<a href=\\\"'+phpSelf+'?cmd=dl&chspic='+imgLink[id]+'\\\">\".sts(TEXT_DOWNLOAD).\"</a><br><br>';\" : \"\").\"\r\n\t\t\t\t}\r\n\t\t\t\telse if (type == 'file')\r\n\t\t\t\t{\r\n\t\t\t\t\tif (fileThumb[id] != '')\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tinfo += '<img class=\\\"thumb\\\" alt=\\\"\\\" src=\\\"'+phpSelf+'?cmd=thumb&chspic='+fileThumb[id]+'\\\">';\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tinfo += '<br><br>\".sts(TEXT_NO_PREVIEW_FILE).\"<br>';\r\n\t\t\t\t\t}\r\n\t\t\t\t\tinfo += '</div>';\r\n\t\t\t\t\tinfo += '<strong>\".sts(TEXT_FILE_NAME).\"</strong><br><div class=\\\"chspic_info_text\\\">'+fileName[id]+'</div><br>';\r\n\t\t\t\t\tvar splint = fileInfo[id].split('|');\r\n\t\t\t\t\tinfo += '<strong>\".sts(TEXT_DESCRIPTION).\"</strong><br><div class=\\\"chspic_info_text\\\">'+splint[2]+'<br></div><br>';\r\n\t\t\t\t\tinfo += '<strong>\".sts(TEXT_INFO).\"</strong><br><div class=\\\"chspic_info_text\\\">';\r\n\t\t\t\t\tinfo += '\".sts(TEXT_DATE).\": '+dateFormat(splint[0])+'<br>';\r\n\t\t\t\t\tinfo += '\".sts(TEXT_FILESIZE).\": '+splint[1]+'<br>';\r\n\t\t\t\t\tinfo += '</div><br>';\r\n\t\t\t\t}\r\n\t\t\t\tgebi('box_inner_info').innerHTML = info;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tfunction toggleInfo(status)\r\n\t\t{\r\n\t\t\tif (status)\r\n\t\t\t{\r\n\t\t\t\tgebi('box_info').style.visibility='hidden';\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tsetOpacity('box_info', 0);\r\n\t\t\t\tgebi('box_info').style.visibility='visible';\r\n\t\t\t\tfadeOpacity('box_info', 0,\t100, \".FADE_DURATION_MS.\");\r\n\t\t\t}\r\n\t\t\tshowInfo = !status;\r\n\t\t\tinitDisplay();\r\n\t\t}\r\n\r\n\r\n\t\tfunction openGallery(id, type)\r\n\t\t{\r\n\t\t\twindow.location=phpSelf+'?chspic='+((type=='nav')?navLink[id]:dirLink[id])+(showInfo?'&info=1':'');\r\n\t\t}\r\n\r\n\r\n\t\tfunction openFile(id)\r\n\t\t{\r\n\t\t\tif (\".(FILE_IN_NEW_WINDOW ? \"true\" : \"false\").\")\r\n\t\t\t{\r\n\t\t\t\twindow.open(phpSelf+'?cmd=file&chspic='+fileLink[id]);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\twindow.location\t= phpSelf+'?cmd=file&chspic='+fileLink[id];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tfunction nextImage(direction)\r\n\t\t{\r\n\t\t\tvar nextIndex;\r\n\t\t\tif (!index)\r\n\t\t\t{\r\n\t\t\t\tif (direction > 0)\r\n\t\t\t\t{\r\n\t\t\t\t\treturn 1;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\treturn (imgLink.length - 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar nextImg = index + direction;\r\n\t\t\tif (nextImg > imgLink.length - 1)\r\n\t\t\t{\r\n\t\t\t\tnextImg = 1;\r\n\t\t\t}\r\n\t\t\tif (nextImg < 1)\r\n\t\t\t{\r\n\t\t\t\tnextImg = imgLink.length - 1;\r\n\t\t\t}\r\n\t\t\treturn nextImg;\r\n\t\t}\r\n\r\n\r\n\t\tfunction cycleImg(direction)\r\n\t\t{\r\n\t\t\tif ((imgLink.length>0)&&naviOk)\r\n\t\t\t{\r\n\t\t\t\topenImageView(nextImage(direction), false);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tfunction showImage(stage)\r\n\t\t{\r\n\t\t\tif(stage==0)\r\n\t\t\t{\r\n\t\t\t\tgebi('full').src = '';\r\n\t\t\t\tnaviOk=false;\r\n\t\t\t\tshowMenu();\r\n\t\t\t\tstage=1;\r\n\t\t\t}\r\n\t\t\tif(stage==1)\r\n\t\t\t{\r\n\t\t\t\tif (preloadImg.complete)\r\n\t\t\t\t{\r\n\t\t\t\t\tgebi('full').src = preloadImg.src;\r\n\t\t\t\t\tinitDisplay();\r\n\t\t\t\t\tstage=2;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(stage==2)\r\n\t\t\t{\r\n\t\t\t\tif(gebi('full').complete)\r\n\t\t\t\t{\r\n\t\t\t\t\tnaviOk=true;\r\n\t\t\t\t\timgFullWidth = preloadImg.width;\r\n\t\t\t\t\timgFullHeight = preloadImg.height;\r\n\t\t\t\t\tfillInfo('img', index);\r\n\t\t\t\t\tinitDisplay();\r\n\t\t\t\t\tpreloadImage(nextImage(1),0);\r\n\t\t\t\t\tgebi('wait').style.visibility='hidden';\r\n\t\t\t\t\tfadeOpacity('full', 0, 100, \".FADE_DURATION_MS.\");\r\n\t\t\t\t\tstage=3;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (waitSpinNr >= waitSpin.length)\r\n\t\t\t{\r\n\t\t\t\twaitSpinNr = 0;\r\n\t\t\t}\r\n\t\t\tgebi('wait').innerHTML = '<div class=\\\"loading\\\">\".sts(TEXT_IMAGE_LOADING).\"' + waitSpin[waitSpinNr] + '</div>';\r\n\t\t\twaitSpinNr++;\r\n\t\t\tif ((stage<3) && index)\r\n\t\t\t{\r\n\t\t\t\tsetTimeout ('showImage('+stage+')',waitSpinSpeed);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tfunction closeImageView()\r\n\t\t{\r\n\t\t\tslideshowActive = false;\r\n\t\t\tgebi('box_wait').style.visibility='hidden';\r\n\t\t\tgebi('wait').style.visibility='hidden';\r\n\t\t\tgebi('box_image').style.visibility='hidden';\r\n\t\t\tgebi('box_left').style.visibility='hidden';\r\n\t\t\tgebi('box_right').style.visibility='hidden';\r\n\t\t\tindex = false;\r\n\t\t\tnaviOk=true;\r\n\t\t\tshowMenu();\r\n\t\t\tfadeOpacity('box_overlay', \".OVERLAY_OPACITY.\", 0, \".FADE_DURATION_MS.\");\r\n\t\t\tgebi('full').width = 1;\r\n\t\t\tgebi('full').height = 1;\r\n\t\t\tgebi('full').src = '';\r\n\t\t\tfillInfo('dir', 0);\r\n\t\t}\r\n\r\n\r\n\t\tfunction setOpacity(id, opacity)\r\n\t\t{\r\n\t\t\tvar element = gebi(id).style;\r\n\t\t\telement.opacity = (opacity / 100);\t/// std\r\n\t\t\telement.MozOpacity = (opacity / 100);\t/// firefox\r\n\t\t\telement.filter = 'alpha(opacity=' + opacity + ')';\t/// IE\r\n\t\t\telement.KhtmlOpacity = (opacity / 100);\t/// Mac\r\n\t\t}\r\n\r\n\r\n\t\tfunction fadeOpacity(id, opacityStart, opacityEnd, msToFade)\r\n\t\t{\r\n\t\t\tvar element = gebi(id);\r\n\t\t\tvar currentTime = new Date().getTime();\r\n\t\t\telement.opacityStart = opacityStart;\r\n\t\t\telement.opacityEnd = opacityEnd;\r\n\t\t\telement.timeStart = currentTime;\r\n\t\t\telement.timeEnd = currentTime + msToFade;\r\n\t\t\tfadeLoop(id, currentTime);\r\n\t\t}\r\n\r\n\r\n\t\tfunction fadeLoop(id, timeStarted)\r\n\t\t{\r\n\t\t\tvar element = gebi(id);\r\n\t\t\tif (timeStarted != element.timeStart)\r\n\t\t\t{\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar currentTime = new Date().getTime();\r\n\t\t\tvar frac = (currentTime - element.timeStart) / (element.timeEnd - element.timeStart);\r\n\t\t\tif (frac >= 1)\r\n\t\t\t{\t\r\n\t\t\t\tsetOpacity(id, element.opacityEnd);\r\n\t\t\t\tif (element.opacityEnd == 0)\r\n\t\t\t\t{\r\n\t\t\t\t\telement.style.visibility='hidden';\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tsetOpacity(id, ((element.opacityEnd - element.opacityStart) * frac) + element.opacityStart);\r\n\t\t\tsetTimeout(\\\"fadeLoop('\\\" + id + \\\"', \\\" + timeStarted + \\\")\\\", 50);\r\n\t\t}\r\n\r\n\r\n\t\tfunction thumbDisplayName(name)\r\n\t\t{\r\n\t\t\tdispName = name.substring(0,\".THUMB_CHARS_MAX.\");\r\n\t\t\tif (name.length > \".THUMB_CHARS_MAX.\")\r\n\t\t\t{\r\n\t\t\t\tdispName += '...';\r\n\t\t\t}\r\n\t\t\treturn dispName;\r\n\t\t}\r\n\r\n\t\t\";\r\n\t\tif (ADMIN===TRUE)\r\n\t\t{\r\n\t\t\techo\"\r\n\r\n\r\n\t\tfunction toggleSelect()\r\n\t\t{\r\n\t\t\tif (selecting)\r\n\t\t\t{\r\n\t\t\t\tselecting = false;\r\n\t\t\t\tshowMenu();\r\n\t\t\t\tselectedDirs = [];\r\n\t\t\t\tselectedImages = [];\r\n\t\t\t\tselectedFiles = [];\r\n\t\t\t\tfor (i = 1; i < dirLink.length; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\tmouseOut(gebi('dir'+i), 'dir', i);\r\n\t\t\t\t}\r\n\t\t\t\tfor (i = 1; i < imgLink.length; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\tmouseOut(gebi('img'+i), 'img', i);\r\n\t\t\t\t}\r\n\t\t\t\tfor (i = 1; i < fileLink.length; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\tmouseOut(gebi('file'+i), 'file', i);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tselecting = true;\r\n\t\t\t\tshowMenu();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tfunction admDelete()\r\n\t\t{\r\n\t\t\tvar sel=selectedDirs.length + selectedImages.length + selectedFiles.length;\r\n\t\t\tif (sel==0)\r\n\t\t\t{\r\n\t\t\t\talert('\".sts(TEXT_NOTHING).\"');\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tif (confirm('\".sts(TEXT_DELETE).\" '+(selectedDirs.length?'\\\\n'+selectedDirs.length+' \".sts(TEXT_DIRS).\"':'')+(selectedImages.length?'\\\\n'+selectedImages.length+' \".sts(TEXT_IMAGES).\"':'')+(selectedFiles.length?'\\\\n'+selectedFiles.length+' \".sts(TEXT_FILES).\"':'')+'?') == true)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar form = makeForm();\r\n\t\t\t\t\tform.appendChild(makeInput('func','delete'));\r\n\t\t\t\t\tformAddSelected(form);\r\n\t\t\t\t\tsubmitForm(form);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tfunction formAddSelected(form)\r\n\t\t{\r\n\t\t\tfor (i=0; i<selectedDirs.length; i++)\r\n\t\t\t{\r\n\t\t\t\tform.appendChild(makeInput('elems[]',dirLink[selectedDirs[i]]));\r\n\t\t\t}\r\n\t\t\tfor (i=0; i<selectedImages.length; i++)\r\n\t\t\t{\r\n\t\t\t\tform.appendChild(makeInput('elems[]',imgLink[selectedImages[i]]));\r\n\t\t\t}\r\n\t\t\tfor (i=0; i<selectedFiles.length; i++)\r\n\t\t\t{\r\n\t\t\t\tform.appendChild(makeInput('elems[]',fileLink[selectedFiles[i]]));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tfunction admRename()\r\n\t\t{\r\n\t\t\tvar sel=selectedDirs.length + selectedImages.length + selectedFiles.length;\r\n\t\t\tif (sel>1)\r\n\t\t\t{\r\n\t\t\t\talert('\".sts(TEXT_ONLY_ONE).\"');\r\n\t\t\t}\r\n\t\t\telse if (sel<1)\r\n\t\t\t{\r\n\t\t\t\talert('\".sts(TEXT_NOTHING).\"');\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tif (selectedDirs.length>0)\r\n\t\t\t\t{\r\n\t\t\t\t\toldName = dirName[selectedDirs[0]];\r\n\t\t\t\t\toldEle = dirLink[selectedDirs[0]];\r\n\t\t\t\t}\r\n\t\t\t\tif (selectedImages.length>0)\r\n\t\t\t\t{\r\n\t\t\t\t\toldName = imgName[selectedImages[0]];\r\n\t\t\t\t\toldEle = imgLink[selectedImages[0]];\r\n\t\t\t\t}\r\n\t\t\t\tif (selectedFiles.length>0)\r\n\t\t\t\t{\r\n\t\t\t\t\toldName = fileName[selectedFiles[0]];\r\n\t\t\t\t\toldEle = fileLink[selectedFiles[0]];\r\n\t\t\t\t}\r\n\t\t\t\tvar newName = prompt('\".sts(TEXT_RENAME).\"', oldName);\r\n\t\t\t\tif (newName != null)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar form = makeForm();\r\n\t\t\t\t\tform.appendChild(makeInput('func','rename'));\r\n\t\t\t\t\tform.appendChild(makeInput('eleToRen',oldEle));\r\n\t\t\t\t\tform.appendChild(makeInput('newName',newName));\r\n\t\t\t\t\tsubmitForm(form);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tfunction admMove(dir)\r\n\t\t{\r\n\t\t\tvar sel=selectedDirs.length + selectedImages.length + selectedFiles.length;\r\n\t\t\tif (sel<1)\r\n\t\t\t{\r\n\t\t\t\talert('\".sts(TEXT_NOTHING).\"');\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tvar ifrm = document.createElement('iframe');\r\n\t\t\t\tifrm.setAttribute('src', phpSelf+'?cmd=dirs&chspic='+dir);\r\n\t\t\t\tvar ele=gebi('box_data');\r\n\t\t\t\tele.innerHTML='';\r\n\t\t\t\tele.appendChild(ifrm);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tfunction admMovePost(toFolder,toName)\r\n\t\t{\r\n\t\t\tvar ele=gebi('box_admin');\r\n\t\t\tele.style.visibility='hidden';\r\n\t\t\tele.innerHTML='';\r\n\t\t\tif ((toFolder!==false) && (toName!==false))\r\n\t\t\t{\r\n\t\t\t\tif (confirm('\".sts(TEXT_MOVE).\" '+(selectedDirs.length?'\\\\n'+selectedDirs.length+' \".sts(TEXT_DIRS).\"':'')+(selectedImages.length?'\\\\n'+selectedImages.length+' \".sts(TEXT_IMAGES).\"':'')+(selectedFiles.length?'\\\\n'+selectedFiles.length+' \".sts(TEXT_FILES).\"':'')+'\\\\n-> '+toName+'?') == true)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar form = makeForm();\r\n\t\t\t\t\tform.appendChild(makeInput('func','move'));\r\n\t\t\t\t\tform.appendChild(makeInput('toFolder',toFolder));\r\n\t\t\t\t\tformAddSelected(form);\r\n\t\t\t\t\tsubmitForm(form);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tfunction admSell()\r\n\t\t{\r\n\t\t\tvar sel=selectedDirs.length + selectedImages.length + selectedFiles.length;\r\n\t\t\tif (sel<1)\r\n\t\t\t{\r\n\t\t\t\talert('\".sts(TEXT_NOTHING).\"');\r\n\t\t\t}\r\n\t\t\telse if ((sel>1)||(selectedImages.length!=1))\r\n\t\t\t{\r\n\t\t\t\talert('\".sts(TEXT_ONE_IMAGE).\"');\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\teName = imgName[selectedImages[0]];\r\n\t\t\t\teLink = imgLink[selectedImages[0]];\r\n\t\t\t\tif (typeof imgSell[selectedImages[0]]!='undefined')\r\n\t\t\t\t{\r\n\t\t\t\t\tvar sellSplint = imgSell[selectedImages[0]].split('|');\r\n\t\t\t\t\tvar ePrice = (((typeof sellSplint[0]!='undefined')&&(sellSplint[0]!=''))?sellSplint[0]:0.0);\r\n\t\t\t\t\tvar eAmount = (((typeof sellSplint[1]!='undefined')&&(sellSplint[1]!=''))?sellSplint[1]:0);\r\n\t\t\t\t\tvar eIdent = (((typeof sellSplint[2]!='undefined')&&(sellSplint[2]!=''))?sellSplint[2]:'');\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tvar ePrice = 0;\r\n\t\t\t\t\tvar eAmount = 0;\r\n\t\t\t\t\tvar eIdent = '';\r\n\t\t\t\t}\r\n\t\t\t\tvar boxForm = '<strong>\".sts(TEXT_PAYPAL_FOR_SALE).\"</strong>: '+eName+'<br><br>'+\r\n\t\t\t\t'<span class=\\\"chspic_button\\\" onclick=\\\"admSellPost(\\''+eLink+'\\', \\''+eName+'\\', \\'ok\\')\\\">\".TEXT_OK.\"</span>'+\r\n\t\t\t\t'<span class=\\\"chspic_button\\\" onclick=\\\"admSellPost(\\''+eLink+'\\', \\''+eName+'\\',\\'del\\')\\\">\".TEXT_DELETE.\"</span>'+\r\n\t\t\t\t'<span class=\\\"chspic_button\\\" onclick=\\\"admSellPost(0,0,\\'cancel\\')\\\">\".TEXT_CANCEL.\"</span><br><br>'+\r\n\t\t\t\t'\".sts(TEXT_PAYPAL_PRICE).\": <input type=\\\"text\\\" value=\\\"'+ePrice+'\\\" id=\\\"ePrice\\\"><br>'+\r\n\t\t\t\t'\".sts(TEXT_PAYPAL_IN_STOCK).\": <input type=\\\"text\\\" value=\\\"'+eAmount+'\\\" id=\\\"eAmount\\\"><br>'+\r\n\t\t\t\t'\".sts(TEXT_PAYPAL_ITEM_ID).\": <input type=\\\"text\\\" value=\\\"'+eIdent+'\\\" id=\\\"eIdent\\\">';\r\n\t\t\t\tvar ele=gebi('box_admin');\r\n\t\t\t\tele.innerHTML=boxForm;\r\n\t\t\t\tele.style.visibility='visible';\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tfunction admSellPost(link, name, action)\r\n\t\t{\r\n\t\t\tvar ePrice = gebi('ePrice').value;\r\n\t\t\tvar eAmount = gebi('eAmount').value;\r\n\t\t\tvar eIdent = gebi('eIdent').value;\r\n\t\t\tvar ele=gebi('box_admin');\r\n\t\t\tele.style.visibility='hidden';\r\n\t\t\tele.innerHTML='';\r\n\t\t\tif (action=='del')\r\n\t\t\t{\r\n\t\t\t\tif (confirm('\".sts(TEXT_DELETE.' '.TEXT_PAYPAL_FOR_SALE).\": '+name+'?') == true)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar form = makeForm();\r\n\t\t\t\t\tform.appendChild(makeInput('func','sell'));\r\n\t\t\t\t\tform.appendChild(makeInput('action','del'));\r\n\t\t\t\t\tform.appendChild(makeInput('ele',link));\r\n\t\t\t\t\tsubmitForm(form);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (action=='ok')\r\n\t\t\t{\r\n\t\t\t\tvar form = makeForm();\r\n\t\t\t\tform.appendChild(makeInput('func','sell'));\r\n\t\t\t\tform.appendChild(makeInput('action','save'));\r\n\t\t\t\tform.appendChild(makeInput('ePrice',ePrice));\r\n\t\t\t\tform.appendChild(makeInput('eAmount',eAmount));\r\n\t\t\t\tform.appendChild(makeInput('eIdent',eIdent));\r\n\t\t\t\tform.appendChild(makeInput('ele',link));\r\n\t\t\t\tsubmitForm(form);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tfunction admDesc()\r\n\t\t{\r\n\t\t\tvar sel=selectedDirs.length + selectedImages.length + selectedFiles.length;\r\n\t\t\tif (sel>1)\r\n\t\t\t{\r\n\t\t\t\talert('\".sts(TEXT_ONLY_ONE).\"');\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tvar eName;\r\n\t\t\t\tvar eLink;\r\n\t\t\t\tvar eDesc;\r\n\t\t\t\tif (selectedDirs.length>0)\r\n\t\t\t\t{\r\n\t\t\t\t\teName = dirName[selectedDirs[0]];\r\n\t\t\t\t\teLink = dirLink[selectedDirs[0]];\r\n\t\t\t\t\tvar splint = dirInfo[selectedDirs[0]].split('|');\r\n\t\t\t\t\teDesc = splint[4];\r\n\t\t\t\t}\r\n\t\t\t\telse if (selectedImages.length>0)\r\n\t\t\t\t{\r\n\t\t\t\t\teName = imgName[selectedImages[0]];\r\n\t\t\t\t\teLink = imgLink[selectedImages[0]];\r\n\t\t\t\t\tvar splint = imgInfo[selectedImages[0]].split('|');\r\n\t\t\t\t\teDesc = splint[29];\r\n\t\t\t\t}\r\n\t\t\t\telse if (selectedFiles.length>0)\r\n\t\t\t\t{\r\n\t\t\t\t\teName = fileName[selectedFiles[0]];\r\n\t\t\t\t\teLink = fileLink[selectedFiles[0]];\r\n\t\t\t\t\tvar splint = fileInfo[selectedFiles[0]].split('|');\r\n\t\t\t\t\teDesc = splint[2];\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\teName = dirName[0];\r\n\t\t\t\t\teLink = dirLink[0];\r\n\t\t\t\t\tvar splint = dirInfo[0].split('|');\r\n\t\t\t\t\teDesc = splint[4];\r\n\t\t\t\t}\r\n\t\t\t\tvar boxForm = '\".sts(TEXT_DESCRIPTION).\": '+eName+'<br><br>'+\r\n\t\t\t\t'<span class=\\\"chspic_button\\\" onclick=\\\"admDescPost(\\''+eLink+'\\', \\''+eName+'\\', \\'ok\\')\\\">\".sts(TEXT_OK).\"</span>'+\r\n\t\t\t\t'<span class=\\\"chspic_button\\\" onclick=\\\"admDescPost(\\''+eLink+'\\', \\''+eName+'\\',\\'del\\')\\\">\".sts(TEXT_DELETE).\"</span>'+\r\n\t\t\t\t'<span class=\\\"chspic_button\\\" onclick=\\\"admDescPost(0,0,\\'cancel\\')\\\">\".sts(TEXT_CANCEL).\"</span><br><br>'+\r\n\t\t\t\t'<textarea id=\\\"desctxt\\\" rows=\\\"20\\\" cols=\\\"100\\\">'+eDesc.replace(/<br>/gi,'<br>\\\\n')+'</textarea>';\r\n\t\t\t\tvar ele=gebi('box_admin');\r\n\t\t\t\tele.innerHTML=boxForm;\r\n\t\t\t\tele.style.visibility='visible';\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tfunction admUpload(show)\r\n\t\t{\r\n\t\t\tvar ele=gebi('box_admin');\r\n\t\t\tif (show)\r\n\t\t\t{\r\n\t\t\t\tvar boxForm = '\".sts(TEXT_UPLOAD).\" -> '+dirName[0]+'<br><br>'+\r\n\t\t\t\t'<form action=\\\"'+phpSelf+'?chspic='+dirLink[0]+(showInfo?'&info=1':'')+'\\\" method=\\\"post\\\" multipart=\\\"\\\" enctype=\\\"multipart/form-data\\\">'+\r\n\t\t\t\t'<input type=\\\"file\\\" name=\\\"ulele[]\\\" multiple> '+\r\n\t\t\t\t'<input type=\\\"submit\\\" value=\\\"\".sts(TEXT_UPLOAD).\"\\\"> '+\r\n\t\t\t\t'<input type=\\\"button\\\" onclick=\\\"admUpload(false)\\\" value=\\\"\".sts(TEXT_CANCEL).\"\\\">'+\r\n\t\t\t\t'<input type=\\\"hidden\\\" name=\\\"func\\\" value=\\\"upload\\\" multiple>'+\r\n\t\t\t\t'</form>';\r\n\t\t\t\tele.innerHTML=boxForm;\r\n\t\t\t\tele.style.visibility='visible';\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tele.innerHTML='';\r\n\t\t\t\tele.style.visibility='hidden';\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tfunction admDescPost(link, name, action)\r\n\t\t{\r\n\t\t\tvar text=gebi('desctxt').value;\r\n\t\t\tvar ele=gebi('box_admin');\r\n\t\t\tele.style.visibility='hidden';\r\n\t\t\tele.innerHTML='';\r\n\t\t\tif (action=='del')\r\n\t\t\t{\r\n\t\t\t\tif (confirm('\".sts(TEXT_DELETE.\" \".TEXT_DESCRIPTION).\": '+name+'?') == true)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar form = makeForm();\r\n\t\t\t\t\tform.appendChild(makeInput('func','desc'));\r\n\t\t\t\t\tform.appendChild(makeInput('action','del'));\r\n\t\t\t\t\tform.appendChild(makeInput('ele',link));\r\n\t\t\t\t\tsubmitForm(form);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (action=='ok')\r\n\t\t\t{\r\n\t\t\t\tvar form = makeForm();\r\n\t\t\t\tform.appendChild(makeInput('func','desc'));\r\n\t\t\t\tform.appendChild(makeInput('action','save'));\r\n\t\t\t\tform.appendChild(makeInput('text',text));\r\n\t\t\t\tform.appendChild(makeInput('ele',link));\r\n\t\t\t\tsubmitForm(form);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tfunction sendData(data)\r\n\t\t{\r\n\t\t\tvar ele=gebi('box_admin');\r\n\t\t\tele.innerHTML=data;\r\n\t\t\tele.style.visibility='visible';\r\n\t\t}\r\n\r\n\r\n\t\tfunction admMakeDir()\r\n\t\t{\r\n\t\t\tvar newDir = prompt('\".sts(TEXT_MKDIR).\"');\r\n\t\t\tif (newDir)\r\n\t\t\t{\r\n\t\t\t\tvar form = makeForm();\r\n\t\t\t\tform.appendChild(makeInput('func','makedir'));\r\n\t\t\t\tform.appendChild(makeInput('dir',newDir));\r\n\t\t\t\tform.appendChild(makeInput('path',dirLink[0]));\r\n\t\t\t\tsubmitForm(form);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tfunction makeInput(name,value)\r\n\t\t{\r\n\t\t\tvar inp = document.createElement('input');\r\n\t\t\tinp.setAttribute('type','hidden');\r\n\t\t\tinp.setAttribute('name',name);\r\n\t\t\tinp.setAttribute('value',value);\r\n\t\t\treturn inp;\r\n\t\t}\r\n\r\n\r\n\t\tfunction makeForm()\r\n\t\t{\r\n\t\t\tvar selectForm = document.createElement('form');\r\n\t\t\tselectForm.setAttribute('method','post');\r\n\t\t\tselectForm.setAttribute('id','selectForm');\r\n\t\t\tselectForm.setAttribute('action', phpSelf+'?chspic='+dirLink[0]+(showInfo?'&info=1':''));\r\n\t\t\treturn selectForm;\r\n\t\t}\r\n\r\n\r\n\t\tfunction submitForm(form)\r\n\t\t{\r\n\t\t\tdocument.getElementsByTagName('body')[0].appendChild(form);\r\n\t\t\tgebi('selectForm').submit();\r\n\t\t}\r\n\r\n\r\n\t\tfunction selectElement(that, arr, nr)\r\n\t\t{\r\n\t\t\tvar ele = arr.indexOf(nr);\r\n\t\t\tif (ele == -1)\r\n\t\t\t{\r\n\t\t\t\tarr.push(nr);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tarr.splice(ele, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\";\r\n\t\t}\r\n\t\techo \"\r\n\r\n\t\tfunction isSelected(type, nr)\r\n\t\t{\r\n\t\t\tif (type == 'dir')\r\n\t\t\t{\r\n\t\t\t\tvar ele = selectedDirs.indexOf(nr);\r\n\t\t\t}\r\n\t\t\telse if (type == 'img')\r\n\t\t\t{\r\n\t\t\t\tvar ele = selectedImages.indexOf(nr);\r\n\t\t\t}\r\n\t\t\telse if (type == 'file')\r\n\t\t\t{\r\n\t\t\t\tvar ele = selectedFiles.indexOf(nr);\r\n\t\t\t}\r\n\t\t\tif (ele == -1)\r\n\t\t\t{\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tfunction mouseOver(that, type, nr)\r\n\t\t{\r\n\t\t\tfillInfo(type, nr);\r\n\t\t\tif (isSelected(type, nr))\r\n\t\t\t{\r\n\t\t\t\tthat.className='innerbox_marked';\r\n\t\t\t}\r\n\t\t\telse if (type=='dir')\r\n\t\t\t{\r\n\t\t\t\tthat.className='innerboxdir_hover';\r\n\t\t\t}\r\n\t\t\telse if (type=='img')\r\n\t\t\t{\r\n\t\t\t\tthat.className='innerboximg_hover';\r\n\t\t\t}\r\n\t\t\telse if (type=='file')\r\n\t\t\t{\r\n\t\t\t\tthat.className='innerboxfile_hover';\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tfunction mouseOut(that, type, nr)\r\n\t\t{\r\n\t\t\tfillInfo('dir', 0);\r\n\t\t\tif (isSelected(type, nr))\r\n\t\t\t{\r\n\t\t\t\tthat.className='innerbox_marked';\r\n\t\t\t}\r\n\t\t\telse if (type=='dir')\r\n\t\t\t{\r\n\t\t\t\tthat.className='innerboxdir';\r\n\t\t\t}\r\n\t\t\telse if (type=='img')\r\n\t\t\t{\r\n\t\t\t\tthat.className='innerboximg';\r\n\t\t\t}\r\n\t\t\telse if (type=='file')\r\n\t\t\t{\r\n\t\t\t\tthat.className='innerboxfile';\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tfunction mouseClick(that, type, nr)\r\n\t\t{\r\n\t\t\tif (selecting)\r\n\t\t\t{\r\n\t\t\t\tif (type == 'dir')\r\n\t\t\t\t{\r\n\t\t\t\t\tselectElement(that, selectedDirs, nr);\r\n\t\t\t\t\tthat.className=(isSelected(type, nr)?'innerbox_marked':'innerboxdir');\r\n\t\t\t\t}\r\n\t\t\t\telse if (type == 'img')\r\n\t\t\t\t{\r\n\t\t\t\t\tselectElement(that, selectedImages, nr);\r\n\t\t\t\t\tthat.className=(isSelected(type, nr)?'innerbox_marked':'innerboximg');\r\n\t\t\t\t}\r\n\t\t\t\telse if (type == 'file')\r\n\t\t\t\t{\r\n\t\t\t\t\tselectElement(that, selectedFiles, nr);\r\n\t\t\t\t\tthat.className=(isSelected(type, nr)?'innerbox_marked':'innerboxfile');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tif (type == 'dir')\r\n\t\t\t\t{\r\n\t\t\t\t\topenGallery(nr);\r\n\t\t\t\t}\r\n\t\t\t\telse if (type == 'img')\r\n\t\t\t\t{\r\n\t\t\t\t\topenImageView(nr, false);\r\n\t\t\t\t}\r\n\t\t\t\telse if (type == 'file')\r\n\t\t\t\t{\r\n\t\t\t\t\topenFile(nr);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tfunction addElement(elementNumber, type)\r\n\t\t{\r\n\t\t\tvar divClassName = 'thumbbox';\r\n\t\t\tvar content='';\r\n\t\t\tif (type == 'dir')\r\n\t\t\t{\r\n\t\t\t\tcontent += '<div id=\\\"dir'+elementNumber+'\\\" onclick=\\\"mouseClick(this, \\'dir\\', '+elementNumber+')\\\"';\r\n\t\t\t\tif (!itd)\r\n\t\t\t\t{\r\n\t\t\t\t\tcontent += ' onmouseover=\\\"mouseOver(this, \\'dir\\', '+elementNumber+')\\\" onmouseout=\\\"mouseOut(this, \\'dir\\', '+elementNumber+')\\\"';\r\n\t\t\t\t}\r\n\t\t\t\tcontent += ' class=\\\"innerboxdir\\\">';\r\n\t\t\t\tcontent += '<div class=\\\"thumbimgbox\\\">';\r\n\t\t\t\tif (dirThumb[elementNumber] != '')\r\n\t\t\t\t{\r\n\t\t\t\t\tcontent += '<img class=\\\"thumb\\\" alt=\\\"\\\" src=\\\"'+phpSelf+'?cmd=thumb&chspic='+dirThumb[elementNumber]+'\\\">';\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tcontent += '<br><br>\".sts(TEXT_NO_IMAGES).\"';\r\n\t\t\t\t}\r\n\t\t\t\tcontent += '</div>';\r\n\t\t\t\t\". (THUMB_CHARS_MAX ? \"content += ''+thumbDisplayName(dirName[elementNumber])+'';\" : \"\").\"\r\n\t\t\t\tcontent += '</div>';\r\n\t\t\t}\r\n\t\t\telse if (type == 'img')\r\n\t\t\t{\r\n\t\t\t\tcontent += '<div id=\\\"img'+elementNumber+'\\\" onclick=\\\"mouseClick(this, \\'img\\', '+elementNumber+')\\\"';\r\n\t\t\t\tif (!itd)\r\n\t\t\t\t{\r\n\t\t\t\t\tcontent += ' onmouseover=\\\"mouseOver(this, \\'img\\', '+elementNumber+')\\\" onmouseout=\\\"mouseOut(this, \\'img\\', '+elementNumber+')\\\"';\r\n\t\t\t\t}\r\n\t\t\t\tcontent += ' class=\\\"innerboximg\\\">';\r\n\t\t\t\tcontent += '<div class=\\\"thumbimgbox\\\"><img class=\\\"thumb\\\" alt=\\\"\\\" src=\\\"'+phpSelf+'?cmd=thumb&chspic='+imgLink[elementNumber]+'\\\"></div>';\r\n\t\t\t\t\". (THUMB_CHARS_MAX ? \"content += thumbDisplayName(imgName[elementNumber]);\" : \"\").\"\r\n\t\t\t\tcontent += '</div>';\r\n\t\t\t}\r\n\t\t\telse if (type == 'file')\r\n\t\t\t{\r\n\t\t\t\tcontent += '<div id=\\\"file'+elementNumber+'\\\" onclick=\\\"mouseClick(this, \\'file\\', '+elementNumber+')\\\"';\r\n\t\t\t\tif (!itd)\r\n\t\t\t\t{\r\n\t\t\t\t\tcontent += ' onmouseover=\\\"mouseOver(this, \\'file\\', '+elementNumber+')\\\" onmouseout=\\\"mouseOut(this, \\'file\\', '+elementNumber+')\\\"';\r\n\t\t\t\t}\r\n\t\t\t\tcontent += ' class=\\\"innerboxfile\\\">';\r\n\t\t\t\tcontent += '<div class=\\\"thumbimgbox\\\">';\r\n\t\t\t\tif (fileThumb[elementNumber] != '')\r\n\t\t\t\t{\r\n\t\t\t\t\tcontent += '<img class=\\\"thumb\\\" alt=\\\"\\\" src=\\\"'+phpSelf+'?cmd=thumb&chspic='+fileThumb[elementNumber]+'\\\">';\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tcontent += '<br><br>\".sts(TEXT_NO_PREVIEW_FILE).\"';\r\n\t\t\t\t}\r\n\t\t\t\tcontent += '</div>'; \r\n\t\t\t\t\". (THUMB_CHARS_MAX ? \"content += thumbDisplayName(fileName[elementNumber]);\" : \"\").\"\r\n\t\t\t\tcontent += '</div>';\r\n\t\t\t}\r\n\t\t\telse if (\".(DIR_DESC_IN_GALLERY?'true':'false').\" && (type == 'desc'))\r\n\t\t\t{\r\n\t\t\t\tvar splint = dirInfo[elementNumber].split('|');\r\n\t\t\t\tif ((typeof splint[4] != 'undefined') && (splint[4] != ''))\r\n\t\t\t\t{\r\n\t\t\t\t\tdivClassName = 'descbox';\r\n\t\t\t\t\tcontent += '<div class=\\\"innerboxdesc\\\">';\r\n\t\t\t\t\tcontent += splint[4];\r\n\t\t\t\t\tcontent += '</div>';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (content != '')\r\n\t\t\t{\r\n\t\t\t\tvar newdiv = document.createElement('div');\r\n\t\t\t\tnewdiv.className = divClassName;\r\n\t\t\t\tnewdiv.innerHTML = content;\r\n\t\t\t\tvar boxC = gebi('box_gallery');\r\n\t\t\t\tboxC.appendChild(newdiv);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tfunction showGallery(initOpenImage)\r\n\t\t{\r\n\t\t\tinitDisplay();\r\n\t\t\tif (initOpenImage)\r\n\t\t\t{\r\n\t\t\t\topenImageView(initOpenImage, false);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tfillInfo('dir', 0);\r\n\t\t\t}\r\n\r\n\t\t\tif (showInfo)\r\n\t\t\t{\r\n\t\t\t\ttoggleInfo(false);\r\n\t\t\t}\r\n\r\n\t\t\tvar navLinks = '';\r\n\t\t\tfor (i = 1; i < navLink.length; i++)\r\n\t\t\t{\r\n\t\t\t\tif (navLink[i] != '')\r\n\t\t\t\t{\r\n\t\t\t\t\tnavLinks += '<span class=\\\"chspic_button_nav\\\" onclick=\\\"openGallery('+i+', \\'nav\\')\\\">'+navName[i]+'</span>';\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tnavLinks += navName[i];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tgebi('navi').innerHTML = navLinks;\r\n\t\t\taddElement(0, 'desc');\r\n\t\t\tfor (i = 1; i < dirLink.length; i++)\r\n\t\t\t{\r\n\t\t\t\taddElement(i, 'dir');\r\n\t\t\t}\r\n\t\t\tfor (i = 1; i < imgLink.length; i++)\r\n\t\t\t{\r\n\t\t\t\taddElement(i, 'img');\r\n\t\t\t}\r\n\t\t\tfor (i = 1; i < fileLink.length; i++)\r\n\t\t\t{\r\n\t\t\t\taddElement(i, 'file');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tfunction slideshow(click)\r\n\t\t{\r\n\t\t\tif(slideshowActive)\r\n\t\t\t{\r\n\t\t\t\tif(click)\r\n\t\t\t\t{\r\n\t\t\t\t\topenImageView(nextImage(1),false);\r\n\t\t\t\t\tslideshowSec=0;\r\n\t\t\t\t}\r\n\t\t\t\tif(slideshowSec>=\".SLIDESHOW_DELAY_SEC.\")\r\n\t\t\t\t{\r\n\t\t\t\t\tif(preloadImg.complete)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\topenImageView(nextImage(1),false);\r\n\t\t\t\t\t\tslideshowSec=0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tslideshowSec++;\r\n\t\t\t\tsetTimeout('slideshow(false)',1000);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tslideshowSec=0;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t\";\r\n\t\tif (PAYPAL_ENABLED)\r\n\t\t{\r\n\t\t\techo \"\r\n\t\t\tfunction paypal(id, buyId)\r\n\t\t\t{\r\n\t\t\t\tvar sellSplint = imgSell[id].split('|');\r\n\t\t\t\tvar SelfUrl = 'http://\".$_SERVER[\"DOMAIN_NAME\"].$_SERVER[\"PHP_SELF\"].\"';\r\n\t\t\t\tvar returnSold = SelfUrl+'?sold='+buyId;\r\n\t\t\t\tvar returnCancel = SelfUrl+'?chspic=\".$_GET['chspic'].\"';\r\n\t\t\t\tgebi('paypalReturn').value = returnSold;\r\n\t\t\t\tgebi('paypalCancelReturn').value = returnCancel;\r\n\t\t\t\tgebi('paypalAmount').value = sellSplint[0];\r\n\t\t\t\tgebi('paypalItemName').value = imgName[id];\r\n\t\t\t\tif((typeof sellSplint[2]!='undefined')&&(sellSplint[2]!=''))\r\n\t\t\t\t{\r\n\t\t\t\t\tgebi('paypalItemNumber').value = sellSplint[2];\r\n\t\t\t\t}\r\n\t\t\t\tdocument.forms[\\\"_xclick\\\"].submit();\r\n\t\t\t}\r\n\t\t\t\";\r\n\t\t}\r\n\t\techo \"navLink[1] = '\".chspic_url_string('').\"';\\n\";\r\n\t\techo \"navName[1] = '\".sts(TEXT_HOME).\"';\\n\\n\";\r\n\r\n\t\t$links = explode(\"/\", GALLERY);\r\n\t\t$gal_dirs = \"\";\r\n\t\tif (GALLERY and is_array($links))\r\n\t\t{\r\n\t\t\tfor ($i = 0; $i < count($links); $i++)\r\n\t\t\t{\r\n\t\t\t\tif ($links[$i]!=='')\r\n\t\t\t\t{\r\n\t\t\t\t\t$gal_dirs .= $links[$i].\"/\";\r\n\t\t\t\t\t$display_name = (in_array(DIR_NAME_FILE, $misc)?@file(GALLERY_ROOT.$gal_dirs.DIR_NAME_FILE):\"\");\r\n\t\t\t\t\tif ($display_name)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$display_name = trim($display_name[0]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$display_name = chspic_display_name($links[$i], TRUE);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$a_names[] = $display_name;\r\n\t\t\t\t\t$a_links[] = $gal_dirs;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t$link_disp_lenght = strlen(TEXT_HOME) + 4;\r\n\t\t\t$start_link = count($a_names)-1;\r\n\t\t\tfor($i = count($a_names)-1; $i >= 0; $i--)\r\n\t\t\t{\r\n\t\t\t\t$link_disp_lenght += strlen($a_names[$i]) + 5;\r\n\t\t\t\tif ($link_disp_lenght < NAVI_CHARS_MAX)\r\n\t\t\t\t{\r\n\t\t\t\t\t$start_link = $i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t$i = 2;\r\n\t\t\tfor ($link_nr = $start_link; $link_nr < count($a_links); $link_nr++)\r\n\t\t\t{\r\n\t\t\t\tif(($start_link > 0) and ($link_nr == $start_link))\r\n\t\t\t\t{\r\n\t\t\t\t\techo \"navLink[\".$i.\"] = '';\\n\";\r\n\t\t\t\t\techo \"navName[\".$i.\"] = '\".sts(\" ... \").\"';\\n\\n\";\r\n\t\t\t\t\t$i++;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\techo \"navLink[\".$i.\"] = '';\\n\";\r\n\t\t\t\t\techo \"navName[\".$i.\"] = '\".sts(\" > \").\"';\\n\\n\";\r\n\t\t\t\t\t$i++;\r\n\t\t\t\t}\r\n\t\t\t\techo \"navLink[\".$i.\"] = '\".chspic_url_string($a_links[$link_nr]).\"';\\n\";\r\n\t\t\t\techo \"navName[\".$i.\"] = '\".sts($a_names[$link_nr]).\"';\\n\\n\";\r\n\t\t\t\t$i++;\r\n\t\t\t}\r\n\t\t\techo \"dirLink[0] = '\".chspic_url_string($a_links[count($a_links)-1]).\"';\\n\";\r\n\t\t\techo \"dirName[0] = '\".sts((count($a_links) == 0 ? TEXT_HOME : $a_names[count($a_links)-1])).\"';\\n\";\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\techo \"dirLink[0] = '\".chspic_url_string(\"\").\"';\\n\";\r\n\t\t\techo \"dirName[0] = '\".sts(TEXT_HOME).\"';\\n\";\r\n\t\t}\r\n\t\tif ((DIR_THUMB_FILE) and file_exists(GALLERY_ROOT.GALLERY.DIR_THUMB_FILE))\r\n\t\t{\r\n\t\t\t$filed = explode(\"|\", @file_get_contents(DATA_ROOT.\"info/\".GALLERY.DIR_THUMB_FILE));\r\n\t\t\tif (filemtime(GALLERY_ROOT.GALLERY.DIR_THUMB_FILE)!=$filed[0])\r\n\t\t\t{\r\n\t\t\t\tchspic_delete_from_data_root(GALLERY.DIR_THUMB_FILE);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!file_exists(DATA_ROOT.\"info/\".GALLERY.\"_chspic_dir\"))\r\n\t\t{\r\n\t\t\tchspic_set_dir_info(GALLERY);\r\n\t\t}\r\n\t\t$filed = explode(\"|\", file_get_contents(DATA_ROOT.\"info/\".GALLERY.\"_chspic_dir\"));\r\n\t\tif ((count($dirs) != $filed[0]) or (count($images) != $filed[1]) or (count($files) != $filed[2]))\r\n\t\t{\r\n\t\t\tchspic_set_dir_info(GALLERY);\r\n\t\t\t$filed = explode(\"|\", file_get_contents(DATA_ROOT.\"info/\".GALLERY.\"_chspic_dir\"));\r\n\t\t}\r\n\t\techo \"dirThumb[0] = '\".$filed[4].\"';\\n\";\r\n\t\techo \"dirInfo[0] = '\".sts($filed[3].\"|\".$filed[0].\"|\".$filed[1].\"|\".$filed[2].\"|\".(in_array(DIR_DESC_FILE, $misc)?@file_get_contents(GALLERY_ROOT.GALLERY.DIR_DESC_FILE):\"\"),false,DESC_NL_TO_BR).\"';\\n\\n\";\r\n\t\t$item = 1;\r\n\t\tforeach ($dirs as $val)\r\n\t\t{\r\n\t\t\t$display_name = @file(GALLERY_ROOT.GALLERY.$val.\"/\".DIR_NAME_FILE);\r\n\t\t\tif ($display_name)\r\n\t\t\t{\r\n\t\t\t\t$display_name = trim($display_name[0]);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t$display_name = chspic_display_name($val, TRUE);\r\n\t\t\t}\r\n\t\t\techo \"dirName[\".($item).\"] = '\".sts($display_name).\"';\\n\";\r\n\t\t\techo \"dirLink[\".($item).\"] = '\".chspic_url_string((GALLERY.$val.\"/\")).\"';\\n\";\r\n\t\t\tif (!file_exists(DATA_ROOT.\"info/\".GALLERY.$val.\"/_chspic_dir\"))\r\n\t\t\t{\r\n\t\t\t\tchspic_set_dir_info(GALLERY.$val.\"/\");\r\n\t\t\t}\r\n\t\t\t$filed = explode(\"|\", file_get_contents(DATA_ROOT.\"info/\".GALLERY.$val.\"/_chspic_dir\"));\r\n\t\t\techo \"dirThumb[\".($item).\"] = '\".$filed[4].\"';\\n\";\r\n\t\t\techo \"dirInfo[\".($item).\"] = '\".sts($filed[3].\"|\".$filed[0].\"|\".$filed[1].\"|\".$filed[2].\"|\".@file_get_contents(GALLERY_ROOT.GALLERY.$val.\"/\".DIR_DESC_FILE),false,DESC_NL_TO_BR).\"';\\n\\n\";\r\n\t\t\t$item++;\r\n\t\t}\r\n\t\t$img_direct_link = FALSE;\r\n\t\t$item = 1;\r\n\t\tforeach ($images as $val)\r\n\t\t{\r\n\t\t\t$showImage = true;\r\n\t\t\tif(SHOW_MAX_IMAGES)\r\n\t\t\t{\r\n\t\t\t\tif($item>=SHOW_MAX_IMAGES)\r\n\t\t\t\t{\r\n\t\t\t\t\t$showImage = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(SHOW_IMAGE_DAYS)\r\n\t\t\t{\r\n\t\t\t\tif(filemtime(GALLERY_ROOT.GALLERY.$val)<(time()-(SHOW_IMAGE_DAYS*86400)))\r\n\t\t\t\t{\r\n\t\t\t\t\t$showImage = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif ($showImage)\r\n\t\t\t{\r\n\t\t\t\tif ($val == IMAGE)\r\n\t\t\t\t{\r\n\t\t\t\t\t$img_direct_link = ($item);\r\n\t\t\t\t}\r\n\t\t\t\techo \"imgLink[\".($item).\"] = '\".chspic_url_string(GALLERY, $val).\"';\\n\";\r\n\t\t\t\t$img_name = chspic_display_name($val, SHOW_IMAGE_EXT);\r\n\t\t\t\techo \"imgName[\".($item).\"] = '\".sts($img_name).\"';\\n\";\r\n\t\t\t\tif (file_exists(DATA_ROOT.'info/'.GALLERY.$val))\r\n\t\t\t\t{\r\n\t\t\t\t\t$filed=file_get_contents(DATA_ROOT.\"info/\".GALLERY.$val);\r\n\t\t\t\t\t$filed_exp=explode('|', $filed);\r\n\t\t\t\t\tif (filemtime(GALLERY_ROOT.GALLERY.$val)!=$filed_exp[0])\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tchspic_delete_from_data_root(GALLERY.$val);\r\n\t\t\t\t\t\t$filed='';\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t$filed='';\r\n\t\t\t\t}\r\n\t\t\t\techo \"imgInfo[\".($item).\"] = '\".sts($filed, true).(in_array($val.DESC_EXT, $misc)?sts(@file_get_contents(GALLERY_ROOT.GALLERY.$val.DESC_EXT),false,DESC_NL_TO_BR):\"\").\"';\\n\";\r\n\t\t\t\tif (PAYPAL_ENABLED)\r\n\t\t\t\t{\r\n\t\t\t\t\t$sell=(in_array($val.PAYPAL_EXTENSION,$misc)?@file(GALLERY_ROOT.GALLERY.$val.PAYPAL_EXTENSION,FILE_IGNORE_NEW_LINES):false);\r\n\t\t\t\t\tif ($sell!=false)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\techo \"imgSell[\".($item).\"] = '\".sts($sell[0].\"|\".$sell[1].\"|\".$sell[2]).\"';\\n\";\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t$item++;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif ($img_direct_link)\r\n\t\t{\r\n\t\t\tdefine(\"IMAGE_ID_IN_URL\", $img_direct_link);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tdefine(\"IMAGE_ID_IN_URL\", FALSE);\r\n\t\t}\r\n\t\tif (count($files))\r\n\t\t{\r\n\t\t\t$item = 1;\r\n\t\t\t$icons=@scandir(GALLERY_ROOT.ICONS_DIR);\r\n\t\t\tforeach ($files as $val)\r\n\t\t\t{\r\n\t\t\t\t$icon_file = @substr(chspic_ext($val), 1).FILE_THUMB_EXT;\r\n\t\t\t\techo \"fileLink[\".($item).\"] = '\".chspic_url_string(GALLERY, $val).\"';\\n\";\r\n\t\t\t\tif (FILE_THUMB_EXT and file_exists(GALLERY_ROOT.GALLERY.$val.FILE_THUMB_EXT))\r\n\t\t\t\t{\r\n\t\t\t\t\techo \"fileThumb[\".($item).\"] = '\".chspic_url_string(GALLERY, $val.FILE_THUMB_EXT).\"';\\n\";\r\n\t\t\t\t}\r\n\t\t\t\telseif (in_array($icon_file, $icons))\r\n\t\t\t\t{\r\n\t\t\t\t\techo \"fileThumb[\".($item).\"] = '\".chspic_url_string(ICONS_DIR, $icon_file).\"';\\n\";\r\n\t\t\t\t}\r\n\t\t\t\telseif (FILE_THUMB_DEFAULT)\r\n\t\t\t\t{\r\n\t\t\t\t\techo \"fileThumb[\".($item).\"] = '\".chspic_url_string(ICONS_DIR, FILE_THUMB_DEFAULT).\"';\\n\";\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\techo \"fileThumb[\".($item).\"] = '';\\n\";\r\n\t\t\t\t}\r\n\t\t\t\techo \"fileName[\".($item).\"] = '\".sts(chspic_display_name($val, SHOW_FILE_EXT)).\"';\\n\";\r\n\t\t\t\tif (!file_exists(DATA_ROOT.\"info/\".GALLERY.$val))\r\n\t\t\t\t{\r\n\t\t\t\t\t$fp = fopen(DATA_ROOT.\"info/\".GALLERY.$val, \"w\");\r\n\t\t\t\t\tfwrite($fp, filemtime(GALLERY_ROOT.GALLERY.$val).\"|\".chspic_file_size(filesize(GALLERY_ROOT.GALLERY.$val)));\r\n\t\t\t\t\tfclose($fp);\r\n\t\t\t\t}\r\n\t\t\t\techo \"fileInfo[\".($item).\"] = '\".sts(@file_get_contents(DATA_ROOT.\"info/\".GALLERY.$val).\"|\".(in_array($val.DESC_EXT, $misc)?@file_get_contents(GALLERY_ROOT.GALLERY.$val.DESC_EXT):\"\"),false,DESC_NL_TO_BR).\"';\\n\\n\";\r\n\t\t\t\t$item++;\r\n\t\t\t}\r\n\t\t}\r\n\t\techo \"\r\n\t\t//-->\r\n\t\t</script>\";\r\n\t}\r\n\r\n\tif (SECURITY_PHRASE=='')\r\n\t{\r\n\t\tif ($sc=@file_get_contents($_SERVER['SCRIPT_FILENAME']))\r\n\t\t{\r\n\t\t\t$phrase=chspic_random(30);\r\n\t\t\t$nr_replace=0;\r\n\t\t\t$sc=str_replace(\"define('SECURITY\".\"_PHRASE', '');\",\"define('SECURITY_PHRASE', '\".$phrase.\"');\",$sc,$nr_replace);\t\t\t\r\n\t\t\tif ($nr_replace === 1)\r\n\t\t\t{\r\n\t\t\t\tif (file_put_contents($_SERVER['SCRIPT_FILENAME'],$sc))\r\n\t\t\t\t{\r\n\t\t\t\t\theader('Location: '.$_SERVER['PHP_SELF']);\r\n\t\t\t\t\texit;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\techo 'You have to set the SECURITY_PHRASE in the top of the script! See readme.txt for description.';\r\n\t\texit;\r\n\t}\r\n\r\n\tif (PASSWORD!=='')\r\n\t{\r\n\t\tsession_start();\r\n\t\tif (isset($_GET['cmd']) and ($_GET['cmd']=='logout'))\r\n\t\t{\r\n\t\t\tsession_unset();\r\n\t\t\theader('Location: '.$_SERVER['PHP_SELF']);\r\n\t\t\texit;\r\n\t\t}\r\n\t\tif (($_SESSION['chspic_access']!==TRUE) or ($_SESSION['chspic_self']!==$_SERVER['PHP_SELF']))\r\n\t\t{\r\n\t\t\tif (isset($_POST['pw']) and ($_POST['pw']===PASSWORD))\r\n\t\t\t{\r\n\t\t\t\t$_SESSION['chspic_access']=TRUE;\r\n\t\t\t\t$_SESSION['chspic_self']=$_SERVER['PHP_SELF'];\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\theader('Content-Type: text/html; charset=\"'.CHARSET.'\"');\r\n\t\t\t\techo '<!DOCTYPE html><html><head><meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0\"><meta charset=\"'.CHARSET.'\"><title></title></head><body>'.\r\n\t\t\t\t'<form  name=\"pf\" action=\"'.$_SERVER['REQUEST_URI'].'\" method=\"post\">'.\r\n\t\t\t\t'<input type=\"password\" name=\"pw\" id=\"pw\" autofocus>'.\r\n\t\t\t\t'<input type=\"submit\" name=\"su\" value=\"'.TEXT_LOGIN.'\">'.\r\n\t\t\t\t'</form></body></html>';\r\n\t\t\t\tsession_write_close();\r\n\t\t\t\texit;\r\n\t\t\t}\r\n\t\t}\r\n\t\tsession_write_close();\r\n\t}\r\n\r\n\t$get_set = FALSE;\r\n\tif (isset($_GET['chspic']))\r\n\t{\r\n\t\t$get = chspic_url_decode($_GET['chspic']);\r\n\t\tif ($get)\r\n\t\t{\r\n\t\t\tdefine('GALLERY', $get[0]);\r\n\t\t\tdefine('IMAGE', $get[1]);\r\n\t\t\t$get_set = TRUE;\r\n\t\t}\r\n\t}\r\n\tif (!$get_set)\r\n\t{\r\n\t\tdefine('GALLERY', '');\r\n\t\tdefine('IMAGE', '');\r\n\t}\r\n\r\n\tif (isset($_GET['cmd']))\r\n\t{\r\n\t\tif ($get_set)\r\n\t\t{\r\n\t\t\tif ($_GET['cmd'] == 'thumb')\r\n\t\t\t{\r\n\t\t\t\tchspic_image(GALLERY, IMAGE, 'thumb');\r\n\t\t\t\texit;\r\n\t\t\t}\r\n\r\n\t\t\tif ($_GET['cmd'] == 'image')\r\n\t\t\t{\r\n\t\t\t\tchspic_image(GALLERY, IMAGE, 'image');\r\n\t\t\t\texit;\r\n\t\t\t}\r\n\r\n\t\t\tif ($_GET['cmd'] == 'preview')\r\n\t\t\t{\r\n\t\t\t\tif (USE_PREVIEW)\r\n\t\t\t\t{\r\n\t\t\t\t\tchspic_image(GALLERY, IMAGE, 'preview');\r\n\t\t\t\t}\r\n\t\t\t\texit;\r\n\t\t\t}\r\n\r\n\t\t\tif (($_GET['cmd'] == 'dl') and TEXT_DOWNLOAD!='')\r\n\t\t\t{\r\n\t\t\t\tchspic_image(GALLERY, IMAGE, 'image', TRUE);\r\n\t\t\t\texit;\r\n\t\t\t}\r\n\r\n\t\t\tif ($_GET['cmd'] == 'file')\r\n\t\t\t{\r\n\t\t\t\theader('Location: '.GALLERY_ROOT.GALLERY.IMAGE);\r\n\t\t\t\texit;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\theader('Content-Type: text/html; charset=\"'.CHARSET.'\"');\r\n\r\n\tif (PAYPAL_ENABLED)\r\n\t{\r\n\t\tif (isset($_GET['sold']))\r\n\t\t{\r\n\t\t\tif ($sell_file=file(DATA_ROOT.'buy/'.$_GET['sold'],FILE_IGNORE_NEW_LINES))\r\n\t\t\t{\r\n\t\t\t\tif($sell_content=file(GALLERY_ROOT.$sell_file[0].PAYPAL_EXTENSION,FILE_IGNORE_NEW_LINES))\r\n\t\t\t\t{\r\n\t\t\t\t\t$fp = fopen(GALLERY_ROOT.$sell_file[0].PAYPAL_EXTENSION,'w');\r\n\t\t\t\t\tfwrite($fp,$sell_content[0].\"\\r\\n\".(((int)$sell_content[1])-1).\"\\r\\n\".$sell_content[2]);\r\n\t\t\t\t\tfclose($fp);\r\n\t\t\t\t\tunlink(DATA_ROOT.'buy/'.$_GET['sold']);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif (ADMIN===TRUE)\r\n\t{\r\n\t\tif (isset($_POST['func']))\r\n\t\t{\r\n\t\t\tif ($_POST['func']==='move')\r\n\t\t\t{\r\n\t\t\t\tif (isset($_POST['toFolder']) and isset($_POST['elems']) and is_array($_POST['elems']) and (count($_POST['elems']) > 0))\r\n\t\t\t\t{\r\n\t\t\t\t\t$to_dir_array = chspic_url_decode($_POST['toFolder']);\r\n\t\t\t\t\tif (($to_dir_array!==false) and ($to_dir_array[1]==='') and is_dir(GALLERY_ROOT.$to_dir_array[0]))\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$to_dir=GALLERY_ROOT.$to_dir_array[0];\r\n\t\t\t\t\t\tforeach ($_POST['elems'] as $elem)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t$move_elem = chspic_url_decode($elem);\r\n\t\t\t\t\t\t\tif ($move_elem)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tif (($move_elem[1]==='') and (is_dir(GALLERY_ROOT.$move_elem[0])))\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t$slash_pos=strrpos($move_elem[0],'/',-2);\r\n\t\t\t\t\t\t\t\t\tif($slash_pos!==FALSE)\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t$slash_pos+=1;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t$slash_pos=0;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t$dir_name = substr($move_elem[0],$slash_pos);\r\n\t\t\t\t\t\t\t\t\trename(GALLERY_ROOT.$move_elem[0], $to_dir.$dir_name);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t$file_to_move=GALLERY_ROOT.$move_elem[0].$move_elem[1];\r\n\t\t\t\t\t\t\t\t\trename($file_to_move, $to_dir.$move_elem[1]);\r\n\t\t\t\t\t\t\t\t\tif (file_exists($file_to_move.DESC_EXT))\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\trename($file_to_move.DESC_EXT, $to_dir.$move_elem[1].DESC_EXT);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tif (chspic_image_type($file_to_move) and (file_exists($file_to_move.PAYPAL_EXTENSION)))\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\trename($file_to_move.PAYPAL_EXTENSION, $to_dir.$move_elem[1].PAYPAL_EXTENSION);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\telseif (file_exists($file_to_move.FILE_THUMB_EXT))\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\trename($file_to_move.FILE_THUMB_EXT, $to_dir.$move_elem[1].FILE_THUMB_EXT);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif ($_POST['func']==='delete')\r\n\t\t\t{\r\n\t\t\t\tif (isset($_POST['elems']) and is_array($_POST['elems']) and (count($_POST['elems']) > 0))\r\n\t\t\t\t{\r\n\t\t\t\t\tforeach ($_POST['elems'] as $elem)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$del_elem = chspic_url_decode($elem);\r\n\t\t\t\t\t\tif ($del_elem)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t$element=GALLERY_ROOT.$del_elem[0].$del_elem[1];\r\n\t\t\t\t\t\t\tchspic_delete($element);\r\n\t\t\t\t\t\t\tif (!is_dir($element))\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tchspic_delete($element.DESC_EXT);\r\n\t\t\t\t\t\t\t\tif (chspic_image_type($element))\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tchspic_delete($element.PAYPAL_EXTENSION);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tchspic_delete($element.FILE_THUMB_EXT);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (($_POST['func']==='makedir') and (isset($_POST['dir'])) and (isset($_POST['path'])))\r\n\t\t\t{\r\n\t\t\t\t$new_dir=$_POST['dir'];\r\n\t\t\t\t$path=$_POST['path'];\r\n\t\t\t\tif (($new_dir!=='') and $path)\r\n\t\t\t\t{\r\n\t\t\t\t\t$path = chspic_url_decode($path);\r\n\t\t\t\t\tif ($path and ($path[1]===''))\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$path=GALLERY_ROOT.$path[0];\r\n\t\t\t\t\t\tchspic_mkdir($path.$new_dir);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (($_POST['func']==='rename') and (isset($_POST['eleToRen'])) and (isset($_POST['newName'])))\r\n\t\t\t{\r\n\t\t\t\t$newName=$_POST['newName'];\r\n\t\t\t\t$eleToRen=$_POST['eleToRen'];\r\n\t\t\t\tif ($newName!=='' and $eleToRen)\r\n\t\t\t\t{\r\n\t\t\t\t\t$eleToRen = chspic_url_decode($eleToRen);\r\n\t\t\t\t\tif ($eleToRen)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif ($eleToRen[1]!=='')\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t$newName.=((!SHOW_IMAGE_EXT and chspic_image_type($eleToRen[1]))?chspic_ext($eleToRen[1]):'');\r\n\t\t\t\t\t\t\tif ((!file_exists(GALLERY_ROOT.$eleToRen[0].$newName)) and (!is_dir(GALLERY_ROOT.$eleToRen[0].$newName)))\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tif (chspic_image_type($eleToRen[1]))\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tif (file_exists(GALLERY_ROOT.$eleToRen[0].$eleToRen[1].PAYPAL_EXTENSION))\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\trename(GALLERY_ROOT.$eleToRen[0].$eleToRen[1].PAYPAL_EXTENSION, GALLERY_ROOT.$eleToRen[0].$newName.PAYPAL_EXTENSION);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telseif (file_exists(GALLERY_ROOT.$eleToRen[0].$eleToRen[1].FILE_THUMB_EXT))\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\trename(GALLERY_ROOT.$eleToRen[0].$eleToRen[1].FILE_THUMB_EXT, GALLERY_ROOT.$eleToRen[0].$newName.FILE_THUMB_EXT);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif (file_exists(GALLERY_ROOT.$eleToRen[0].$eleToRen[1].DESC_EXT))\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\trename(GALLERY_ROOT.$eleToRen[0].$eleToRen[1].DESC_EXT, GALLERY_ROOT.$eleToRen[0].$newName.DESC_EXT);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\trename(GALLERY_ROOT.$eleToRen[0].$eleToRen[1], GALLERY_ROOT.$eleToRen[0].$newName);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t$oldPath=GALLERY_ROOT.$eleToRen[0];\r\n\t\t\t\t\t\t\t$oldPath=rtrim($oldPath,'/');\r\n\t\t\t\t\t\t\t$newPath = substr($oldPath, 0, strrpos($oldPath, '/')+1).$newName;\r\n\t\t\t\t\t\t\tif ((!file_exists($newPath)) and (!is_dir($newPath)))\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\trename(GALLERY_ROOT.$eleToRen[0], $newPath);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif ($_POST['func']==='desc')\r\n\t\t\t{\r\n\t\t\t\t$action=$_POST['action'];\r\n\t\t\t\t$text=$_POST['text'];\r\n\t\t\t\t$ele=$_POST['ele'];\r\n\t\t\t\tif (($action==='del') or ($text===''))\r\n\t\t\t\t{\r\n\t\t\t\t\t$eleWd = chspic_url_decode($ele);\r\n\t\t\t\t\tif ($eleWd)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$element=GALLERY_ROOT.$eleWd[0].$eleWd[1];\r\n\t\t\t\t\t\tif (is_dir($element))\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tchspic_delete($element.DIR_DESC_FILE);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tchspic_delete($element.DESC_EXT);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telseif ($action==='save')\r\n\t\t\t\t{\r\n\t\t\t\t\t$eleWd = chspic_url_decode($ele);\r\n\t\t\t\t\tif ($eleWd)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$element=GALLERY_ROOT.$eleWd[0].$eleWd[1];\r\n\t\t\t\t\t\tif (is_dir($element))\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t$element.=DIR_DESC_FILE;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t$element.=DESC_EXT;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tfile_put_contents($element,$text);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif ($_POST['func']==='sell')\r\n\t\t\t{\r\n\t\t\t\t$action=$_POST['action'];\r\n\t\t\t\t$ele=$_POST['ele'];\r\n\t\t\t\tif ($action==='del')\r\n\t\t\t\t{\r\n\t\t\t\t\t$eleWd = chspic_url_decode($ele);\r\n\t\t\t\t\tif ($eleWd)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tchspic_delete(GALLERY_ROOT.$eleWd[0].$eleWd[1].PAYPAL_EXTENSION);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telseif ($action==='save')\r\n\t\t\t\t{\r\n\t\t\t\t\t$eleWd = chspic_url_decode($ele);\r\n\t\t\t\t\tif ($eleWd)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tfile_put_contents(GALLERY_ROOT.$eleWd[0].$eleWd[1].PAYPAL_EXTENSION,$_POST['ePrice'].\"\\r\\n\".$_POST['eAmount'].\"\\r\\n\".$_POST['eIdent']);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif ($_POST['func']==='upload')\r\n\t\t\t{\r\n\t\t\t\tif (isset($_FILES['ulele']))\r\n\t\t\t\t{\r\n\t\t\t\t\t$nrUlEle=count($_FILES['ulele']['name']);\r\n\t\t\t\t\tfor ($i=0; $i<$nrUlEle; $i++)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif ($_FILES['ulele']['error'][$i]===0)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tmove_uploaded_file($_FILES['ulele']['tmp_name'][$i],GALLERY_ROOT.GALLERY.$_FILES['ulele']['name'][$i]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif ($_GET['cmd'] == 'dirs')\r\n\t\t{\r\n\t\t\tchspic_browse_dirs();\r\n\t\t\texit;\r\n\t\t}\r\n\t}\r\n\r\n\tlist($dirs, $images, $files, $misc) = chspic_get_dir(GALLERY);\r\n\techo '<!DOCTYPE html><html><head><meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0\"><meta charset=\"'.CHARSET.'\"><title>'.TEXT_GALLERY_NAME.'</title><style>'.\r\n\t\"\r\n\timg\r\n\t{\r\n\t\t-ms-interpolation-mode:bicubic;\r\n\t}\r\n\r\n\tbody.chspic\r\n\t{\r\n\t\tbackground:$color_body_back;\r\n\t\tcolor:$color_body_text;\r\n\t\tfont-family:Arial, Helvetica, sans-serif;\r\n\t\tfont-size:\".FONT_SIZE.\"px;\r\n\t\tfont-weight:normal;\r\n\t\tmargin:0px;\r\n\t\tpadding:0px;\r\n\t\toverflow:hidden;\r\n\t}\r\n\r\n\tbody.chspic a:active, body.chspic a:link, body.chspic a:visited, body.chspic a:focus\r\n\t{\r\n\t\tcolor:$color_body_link;\r\n\t\ttext-decoration:none;\r\n\t}\r\n\r\n\tbody.chspic a:hover\r\n\t{\r\n\t\tcolor:$color_body_hover;\r\n\t\ttext-decoration:none;\r\n\t}\r\n\r\n\ttable\r\n\t{\r\n\t\tborder-spacing:0px;\r\n\t\tborder-collapse:separate;\r\n\t\tfont-size:\".FONT_SIZE.\"px;\r\n\t\theight:100%;\r\n\t\twidth:100%;\r\n\t}\r\n\r\n\ttable.info td\r\n\t{\r\n\t\tpadding:10px;\r\n\t\tvertical-align:top;\r\n\t}\r\n\r\n\ttable.chspic_disp\r\n\t{\r\n\t\ttext-align:center;\r\n\t\tpadding:0px;\r\n\t\tcellspacing:0px;\r\n\t}\r\n\r\n\ttable.chspic_disp td.menu\r\n\t{\r\n\t\tbackground:$color_menu_back;\r\n\t\tborder-top:1px solid $color_menu_top;\r\n\t\tvertical-align:middle;\r\n\t\twhite-space:nowrap;\r\n\t}\r\n\r\n\ttable.chspic_disp td.navi\r\n\t{\r\n\t\theight:\".NAV_BAR_HEIGHT.\"px;\r\n\t\tbackground:$color_navbar_back;\r\n\t\tborder-top:1px solid $color_navbar_top;\r\n\t\tvertical-align:middle;\r\n\t\twhite-space:nowrap;\r\n\t}\r\n\r\n\ttable.chspic_disp td.mid\r\n\t{\r\n\t\tvertical-align:middle;\r\n\t}\r\n\r\n\tdiv.in\r\n\t{\r\n\t\tline-height:170%;\r\n\t\tpadding-left:30px;\r\n\t}\r\n\r\n\t.chspic_info_text, .loading\r\n\t{\r\n\t\t\".(ROUND_CORNERS?'border-radius:'.ROUND_CORNERS.'px;':'').\"\r\n\t\tbackground:$color_info_back;\r\n\t\tborder:1px solid $color_info_border;\r\n\t\tcolor:$color_info_text;\r\n\t\tpadding:1px 4px 1px 4px;\r\n\t\twidth:200px;\r\n\t}\r\n\t\r\n\t.loading\r\n\t{\r\n\t\tpadding:20px 20px 20px 20px;\r\n\t\tmargin-right:auto;\r\n\t\tmargin-left:auto;\r\n\t}\r\n\t\r\n\t.chspic_button, .chspic_button_hover, .chspic_button_on, .chspic_button_nav, .chspic_button_disabled\r\n\t{\r\n\t\t\".(ROUND_CORNERS?'border-radius:'.ROUND_CORNERS.'px;':'').\"\r\n\t\tcursor:pointer;\r\n\t\tbackground:$color_button_back;\r\n\t\tborder:1px solid $color_button_border;\r\n\t\tcolor:$color_button_text;\r\n\t\tpadding:0px 5px 0px 5px;\r\n\t\tmargin:0px 5px 0px 5px;\r\n\t\twhite-space:nowrap;\r\n\t}\r\n\r\n\t.chspic_button:hover, .chspic_button_nav:hover\r\n\t{\r\n\t\tbackground:$color_button_hover;\r\n\t\tcolor:$color_button_hover_text;\r\n\t}\r\n\r\n\t.chspic_button_hover\r\n\t{\r\n\t\tbackground:$color_button_hover;\r\n\t\tcolor:$color_button_hover_text;\r\n\t}\r\n\r\n\t.chspic_button_on\r\n\t{\r\n\t\tbackground:$color_button_on;\r\n\t\tcolor:$color_button_text_on;\r\n\t}\r\n\r\n\t.chspic_button_disabled\r\n\t{\r\n\t\tcursor:default;\r\n\t\tborder:1px solid $color_button_border_off;\r\n\t\tbackground:$color_button_back_off;\r\n\t\tcolor:$color_button_text_off;\r\n\t}\r\n\r\n\t.chspic_button_nav\r\n\t{\r\n\t\tborder:1px solid $color_button_nav_border;\r\n\t\tbackground:$color_button_nav_back;\r\n\t\tcolor:$color_button_nav_text;\r\n\t}\r\n\r\n\t.thumbbox, .descbox\r\n\t{\r\n\t\tvertical-align:top;\r\n\t\tdisplay:-moz-inline-stack;\r\n\t\tdisplay:inline-block;\r\n\t\tzoom:1;\r\n\t\t*display:inline;\r\n\t\twidth:\".((2 * (THUMB_BORDER_WIDTH + THUMB_MARGIN + THUMB_BOX_MARGIN)) + THUMB_MAX_WIDTH + 2).\"px;\r\n\t\theight:\".((2 * (THUMB_BORDER_WIDTH + THUMB_MARGIN + THUMB_BOX_MARGIN)) + THUMB_MAX_HEIGHT + 2 + THUMB_BOX_EXTRA_HEIGHT).\"px;\r\n\t\tmargin:0px;\r\n\t\tpadding:0px;\r\n\t}\r\n\r\n\t.descbox\r\n\t{\r\n\t\twidth:\".(((2 * (THUMB_BORDER_WIDTH + THUMB_MARGIN + THUMB_BOX_MARGIN)) + THUMB_MAX_WIDTH + 2)*2).\"px;\r\n\t}\r\n\r\n\t.thumbimgbox\r\n\t{\r\n\t\twidth:\".((2 * (THUMB_BORDER_WIDTH + THUMB_MARGIN)) + THUMB_MAX_WIDTH).\"px;\r\n\t\theight:\".((THUMB_BORDER_WIDTH * 2) + THUMB_MARGIN + THUMB_MAX_HEIGHT + 6).\"px;\r\n\t\tmargin:0px; \r\n\t\tpadding:0px;\r\n\t}\r\n\r\n\t.innerboxdir, .innerboximg, .innerboxfile, .innerboxdir_hover, .innerboximg_hover, .innerboxfile_hover, .innerbox_marked\r\n\t{\r\n\t\t\".(ROUND_CORNERS?'border-radius:'.(ROUND_CORNERS*2).'px;':'').\"\r\n\t\tcursor:pointer;\r\n\t\tmargin:\".THUMB_BOX_MARGIN.\"px;\r\n\t\tpadding:0px;\r\n\t\twidth:\".((2 * (THUMB_BORDER_WIDTH + THUMB_MARGIN)) + THUMB_MAX_WIDTH + 2).\"px;\r\n\t\theight:\".((2 * (THUMB_BORDER_WIDTH + THUMB_MARGIN)) + THUMB_MAX_HEIGHT + 2 + THUMB_BOX_EXTRA_HEIGHT).\"px;\r\n\t}\r\n\r\n\t.innerboxdesc\r\n\t{\r\n\t\ttext-align:left;\r\n\t\toverflow:auto;\r\n\t\t\".(ROUND_CORNERS?'border-radius:'.(ROUND_CORNERS*2).'px;':'').\"\r\n\t\tmargin:\".THUMB_BOX_MARGIN.\"px;\r\n\t\tpadding:5px;\r\n\t\twidth:\".(2*(THUMB_BOX_MARGIN+(2 * (THUMB_BORDER_WIDTH + THUMB_MARGIN)) + THUMB_MAX_WIDTH + 2 - 5)).\"px;\r\n\t\theight:\".((2 * (THUMB_BORDER_WIDTH + THUMB_MARGIN)) + THUMB_MAX_HEIGHT + 2 + THUMB_BOX_EXTRA_HEIGHT - 10).\"px;\r\n\t\tborder:1px solid $color_desc_box_border;\r\n\t\tbackground:$color_desc_box_back;\r\n\t\tcolor:$color_desc_box_text;\r\n\t}\r\n\r\n\t.innerboxdir, .innerboxdir_hover, .innerbox_marked\r\n\t{\r\n\t\tborder:1px solid $color_dir_box_border;\r\n\t\tbackground:$color_dir_box_back;\r\n\t\tcolor:$color_dir_box_text;\r\n\t}\r\n\r\n\t.innerboximg, .innerboximg_hover\r\n\t{\r\n\t\tborder:1px solid $color_img_box_border;\r\n\t\tbackground:$color_img_box_back;\r\n\t\tcolor:$color_img_box_text;\r\n\t}\r\n\r\n\t.innerboxfile, .innerboxfile_hover\r\n\t{\r\n\t\tborder:1px solid $color_file_box_border;\r\n\t\tbackground:$color_file_box_back;\r\n\t\tcolor:$color_file_box_text;\r\n\t}\r\n\r\n\t.innerboxdir_hover\r\n\t{\r\n\t\tbackground:$color_dir_hover;\r\n\t\tcolor:$color_dir_hover_text;\r\n\t}\r\n\r\n\t.innerboximg_hover\r\n\t{\r\n\t\tbackground:$color_img_hover;\r\n\t\tcolor:$color_img_hover_text;\r\n\t}\r\n\r\n\t.innerboxfile_hover\r\n\t{\r\n\t\tbackground:$color_file_hover;\r\n\t\tcolor:$color_file_hover_text;\r\n\t}\r\n\r\n\t.innerbox_marked\r\n\t{\r\n\t\tbackground:$color_marked_back;\r\n\t\tcolor:$color_marked_text;\r\n\t}\r\n\r\n\t.full_image\r\n\t{\r\n\t\tcursor:pointer;\r\n\t\tborder:\".FULLIMG_BORDER_WIDTH.\"px solid $color_fullimg_border;\r\n\t}\r\n\r\n\t.banner\r\n\t{\r\n\t\twidth:100%;\r\n\t}\r\n\r\n\t.thumb\r\n\t{\r\n\t\t\".(ROUND_CORNERS?'border-radius:'.ROUND_CORNERS.'px;':'').\"\r\n\t\tmargin:\".THUMB_MARGIN.\"px \".THUMB_MARGIN.\"px 5px \".THUMB_MARGIN.\"px;\r\n\t\tborder:\".THUMB_BORDER_WIDTH.\"px solid $color_thumb_border;\r\n\t}\r\n\r\n\t.sye\r\n\t{\r\n\t\tposition:absolute;\r\n\t\tbottom:10px;\r\n\t\tright:10px;\r\n\t\tz-index:1120;\r\n\t\tcursor:pointer;\r\n\t}\r\n\r\n\t.box_image\r\n\t{\r\n\t\tposition:absolute;\r\n\t\tbottom:\".MENU_BOX_HEIGHT.\"px;\r\n\t\tright:0;\r\n\t\tz-index:1020;\r\n\t\toverflow:auto;\r\n\t\tvisibility:hidden;\r\n\t\ttext-align:center;\r\n\t}\r\n\r\n\t.box_wait\r\n\t{\r\n\t\tposition:absolute;\r\n\t\tbottom:\".MENU_BOX_HEIGHT.\"px;\r\n\t\tright:0;\r\n\t\tz-index:1015;\r\n\t\toverflow:auto;\r\n\t\tvisibility:hidden;\r\n\t\ttext-align:center;\r\n\t}\r\n\r\n\t.box_hud\r\n\t{\r\n\t\tposition:absolute;\r\n\t\tbottom:\".(MENU_BOX_HEIGHT+20).\"px;\r\n\t\tright:0;\r\n\t\tz-index:1200;\r\n\t\tvisibility:hidden;\r\n\t\tcursor:pointer;\r\n\t}\r\n\r\n\t.box_navi\r\n\t{\r\n\t\tposition:absolute;\r\n\t\tbottom:0;\r\n\t\tleft:0;\r\n\t\theight:\".MENU_BOX_HEIGHT.\"px;\r\n\t\twidth:100%;\r\n\t\tz-index:1120;\r\n\t\toverflow:hidden;\r\n\t\ttext-align:center;\r\n\t}\r\n\r\n\t.box_info\r\n\t{\r\n\t\t\".(ROUND_CORNERS?'border-radius:'.(ROUND_CORNERS*2).'px;':'').\"\r\n\t\tposition:absolute;\r\n\t\ttop:10px;\r\n\t\tleft:10px;\r\n\t\twidth:\".INFO_BOX_WIDTH.\"px;\r\n\t\tz-index:1040;\r\n\t\tvisibility:hidden;\r\n\t\toverflow:auto;\r\n\t\tborder:1px solid $color_infobox_border;\r\n\t\tbackground:$color_infobox_back;\r\n\t}\r\n\r\n\t.box_admin\r\n\t{\r\n\t\tposition:absolute;\r\n\t\twidth:100%;\r\n\t\theight:100%;\r\n\t\tvisibility:hidden;\r\n\t\toverflow:auto;\r\n\t\tz-index:1240;\r\n\t\tbackground:$color_infobox_back;\r\n\t}\r\n\r\n\t.box_data\r\n\t{\r\n\t\tposition:absolute;\r\n\t\tvisibility:hidden;\r\n\t}\r\n\r\n\t.box_overlay\r\n\t{\r\n\t\tposition:absolute;\r\n\t\tbottom:\".MENU_BOX_HEIGHT.\"px;\r\n\t\tleft:0;\r\n\t\theight:100%;\r\n\t\twidth:100%;\r\n\t\tz-index:1010;\r\n\t\toverflow:hidden;\r\n\t\tvisibility:hidden;\r\n\t\tbackground:$color_overlay;\r\n\t}\r\n\r\n\t.box_gallery\r\n\t{\r\n\t\ttext-align:center;\r\n\t\tposition:absolute;\r\n\t\ttop:0;\r\n\t\tright:0;\r\n\t\tz-index:1000;\r\n\t\toverflow:auto;\r\n\t\t-webkit-overflow-scrolling:touch;\r\n\t}\r\n\t\".\r\n\t'</style>';\r\n\tchspic_javascript();\r\n\techo '</head>';\r\n\r\n\tif (PAYPAL_ENABLED and $get_set and ($_GET['cmd'] == 'buy') and IMAGE!='')\r\n\t{\r\n\t\t$sell=@file(GALLERY_ROOT.GALLERY.IMAGE.PAYPAL_EXTENSION,FILE_IGNORE_NEW_LINES);\r\n\t\tif (($sell==false) or ($sell[1]<1))\r\n\t\t{\r\n\t\t\techo '<body>'.TEXT_PAYPAL_OUT_BACK.'</body>'; \r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tdate_default_timezone_set('UTC');\r\n\t\t\t$buyId=date('Ymd_His').'_'.chspic_random(16);\r\n\t\t\tif (!chspic_mkdir(DATA_ROOT.'buy/'))\r\n\t\t\t{\r\n\t\t\t\t$handle = opendir(DATA_ROOT.'buy/');\r\n\t\t\t\tif ($handle != FALSE)\r\n\t\t\t\t{\r\n\t\t\t\t\t$week_ago=time()-604800;\r\n\t\t\t\t\twhile(($var=readdir($handle))!==false)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif (!is_dir(DATA_ROOT.'buy/'.$var))\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tif ($week_ago>filemtime(DATA_ROOT.'buy/'.$var))\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tunlink(DATA_ROOT.'buy/'.$var);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tclosedir($directory_handle);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t$fp = fopen(DATA_ROOT.'buy/'.$buyId,'w');\r\n\t\t\tfwrite($fp,GALLERY.IMAGE);\r\n\t\t\tfclose($fp);\r\n\t\t\techo '<body onload=\"paypal('.IMAGE_ID_IN_URL.',\\''.$buyId.'\\');\">'.\r\n\t\t\tTEXT_PAYPAL_PLEASE_WAIT.\r\n\t\t\t'<form  name=\"_xclick\" action=\"https://www.paypal.com/cgi-bin/webscr\" method=\"post\">'.\r\n\t\t\t'<input type=\"hidden\" name=\"cmd\" value=\"_xclick\">'.\r\n\t\t\t'<input type=\"hidden\" name=\"business\" value=\"'.PAYPAL_ACCOUNT.'\">'.\r\n\t\t\t'<input type=\"hidden\" name=\"currency_code\" value=\"'.PAYPAL_CURRENCY.'\">'.\r\n\t\t\t'<input type=\"hidden\" id=\"paypalReturn\" name=\"return\" value=\"\">'.\r\n\t\t\t'<input type=\"hidden\" id=\"paypalCancelReturn\" name=\"cancel_return\" value=\"\">'.\r\n\t\t\t'<input type=\"hidden\" id=\"paypalItemName\" name=\"item_name\" value=\"\">'.\r\n\t\t\t'<input type=\"hidden\" id=\"paypalItemNumber\" name=\"item_number\" value=\"'.GALLERY.IMAGE.'\">'.\r\n\t\t\t'<input type=\"hidden\" id=\"paypalAmount\" name=\"amount\" value=\"\">'.\r\n\t\t\t'</form>'.\r\n\t\t\t'</body>';\r\n\t\t}\r\n\t}\r\n\telse\r\n\t{\r\n\t\techo '<body onresize=\"initDisplay()\" onload=\"showGallery('.(IMAGE_ID_IN_URL?IMAGE_ID_IN_URL:'false').')\" class=\"chspic\">' .\r\n\t\t'<div id=\"box_navi\" class=\"box_navi\">' .\r\n\t\t\t'<table class=\"chspic_disp\">' .\r\n\t\t\t\t'<tr><td class=\"navi\">' .\r\n\t\t\t\t\t'<div id=\"navi\"></div>' .\r\n\t\t\t\t'</td></tr>' .\r\n\t\t\t\t'<tr><td class=\"menu\">' .\r\n\t\t\t\t\t'<div id=\"div_menu\"></div>' .\r\n\t\t\t\t'</td></tr>' .\r\n\t\t\t'</table>' .\r\n\t\t'</div>' .\r\n\t\t'<div id=\"box_image\" class=\"box_image\">' .\r\n\t\t\t'<table class=\"chspic_disp\">' .\r\n\t\t\t\t'<tr><td class=\"mid\">' .\r\n\t\t\t\t\t'<img alt=\"\" src=\"\" id=\"full\" class=\"full_image\" onclick=\"closeImageView()\" onmouseover=\"gebi(\\'button_close\\').className=\\'chspic_button_hover\\'\" onmouseout=\"gebi(\\'button_close\\').className=\\'chspic_button\\'\">' .\r\n\t\t\t\t'</td></tr>' .\r\n\t\t\t'</table>' .\r\n\t\t'</div>' .\r\n\t\t'<div id=\"box_wait\" class=\"box_wait\">' .\r\n\t\t\t'<table class=\"chspic_disp\">' .\r\n\t\t\t\t'<tr><td class=\"mid\">' .\r\n\t\t\t\t\t'<div id=\"wait\"></div>' .\r\n\t\t\t\t'</td></tr>' .\r\n\t\t\t'</table>' .\r\n\t\t'</div>' .\r\n\t\t'<div id=\"box_info\" class=\"box_info\">' .\r\n\t\t\t'<table class=\"info\">' .\r\n\t\t\t\t'<tr><td>' .\r\n\t\t\t\t\t'<div id=\"box_inner_info\"></div>' .\r\n\t\t\t\t'</td></tr>' .\r\n\t\t\t'</table>' .\r\n\t\t'</div>' .\r\n\t\t'<div class=\"sye\" onclick=\"window.open(\\'https://andersmmg.ga/\\')\">by andersmmg</div>'.\r\n\t\t'<div id=\"box_gallery\" class=\"box_gallery\">';\r\n\t\tif (DIR_BANNER_FILE and (file_exists(GALLERY_ROOT.GALLERY.DIR_BANNER_FILE)))\r\n\t\t{\r\n\t\t\techo '<div class=\"banner\">'.@file_get_contents(GALLERY_ROOT.GALLERY.DIR_BANNER_FILE).'</div>';\r\n\t\t}\r\n\t\telseif (TEXT_BANNER)\r\n\t\t{\r\n\t\t\techo '<div class=\"banner\">'.TEXT_BANNER.'</div>';\r\n\t\t}\r\n\t\techo '</div>';\r\n\t\tif (ADMIN===TRUE)\r\n\t\t{\r\n\t\t\techo'<div id=\"box_admin\" class=\"box_admin\"></div>';\r\n\t\t\techo'<div id=\"box_data\" class=\"box_data\"></div>';\r\n\t\t}\r\n\t\techo'<div id=\"box_overlay\" class=\"box_overlay\"></div>' .\r\n\t\t'<div id=\"box_left\" onclick=\"cycleImg(-1)\" onmouseover=\"gebi(\\'button_left\\').className=\\'chspic_button_hover\\'\" onmouseout=\"gebi(\\'button_left\\').className=\\'chspic_button\\'\" class=\"box_hud\"></div>' .\r\n\t\t'<div id=\"box_right\" onclick=\"cycleImg(1)\" onmouseover=\"gebi(\\'button_right\\').className=\\'chspic_button_hover\\'\" onmouseout=\"gebi(\\'button_right\\').className=\\'chspic_button\\'\" class=\"box_hud\"></div>' .\r\n\t\t'<style>.innerboximg, .innerboximg_hover{color:rgba(0,0,0,0);}</style></body>';\r\n\t}\r\n\techo '</html>';\r\n?>"]],"start1":0,"start2":0,"length1":0,"length2":108565}],"length":108565}